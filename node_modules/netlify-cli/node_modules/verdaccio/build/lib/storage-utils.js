"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WHITELIST = void 0;
exports.checkPackageLocal = checkPackageLocal;
exports.checkPackageRemote = checkPackageRemote;
exports.cleanUpLinksRef = cleanUpLinksRef;
exports.cleanUpReadme = cleanUpReadme;
exports.generatePackageTemplate = generatePackageTemplate;
exports.generateRevision = generateRevision;
exports.getLatestReadme = getLatestReadme;
exports.isPublishablePackage = isPublishablePackage;
exports.mergeUplinkTimeIntoLocal = mergeUplinkTimeIntoLocal;
exports.normalizeContributors = normalizeContributors;
exports.normalizePackage = normalizePackage;
exports.prepareSearchPackage = prepareSearchPackage;
exports.publishPackage = publishPackage;

var _lodash = _interopRequireDefault(require("lodash"));

var _cryptoUtils = require("../lib/crypto-utils");

var _constants = require("./constants");

var _search = _interopRequireDefault(require("./search"));

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function generatePackageTemplate(name) {
  return {
    // standard things
    name,
    versions: {},
    time: {},
    [_constants.USERS]: {},
    [_constants.DIST_TAGS]: {},
    _uplinks: {},
    _distfiles: {},
    _attachments: {},
    _rev: ''
  };
}
/**
 * Normalize package properties, tags, revision id.
 * @param {Object} pkg package reference.
 */


function normalizePackage(pkg) {
  const pkgProperties = ['versions', 'dist-tags', '_distfiles', '_attachments', '_uplinks', 'time'];
  pkgProperties.forEach(key => {
    const pkgProp = pkg[key];

    if (_lodash.default.isNil(pkgProp) || (0, _utils.isObject)(pkgProp) === false) {
      pkg[key] = {};
    }
  });

  if (_lodash.default.isString(pkg._rev) === false) {
    pkg._rev = _constants.STORAGE.DEFAULT_REVISION;
  }

  if (_lodash.default.isString(pkg._id) === false) {
    pkg._id = pkg.name;
  } // normalize dist-tags


  (0, _utils.normalizeDistTags)(pkg);
  return pkg;
}

function generateRevision(rev) {
  const _rev = rev.split('-');

  return (+_rev[0] || 0) + 1 + '-' + (0, _cryptoUtils.generateRandomHexString)();
}

function getLatestReadme(pkg) {
  const versions = pkg['versions'] || {};
  const distTags = pkg[_constants.DIST_TAGS] || {}; // FIXME: here is a bit tricky add the types

  const latestVersion = distTags['latest'] ? versions[distTags['latest']] || {} : {};

  let readme = _lodash.default.trim(pkg.readme || latestVersion.readme || '');

  if (readme) {
    return readme;
  } // In case of empty readme - trying to get ANY readme in the following order: 'next','beta','alpha','test','dev','canary'


  const readmeDistTagsPriority = ['next', 'beta', 'alpha', 'test', 'dev', 'canary'];
  readmeDistTagsPriority.map(function (tag) {
    if (readme) {
      return readme;
    }

    const version = distTags[tag] ? versions[distTags[tag]] || {} : {};
    readme = _lodash.default.trim(version.readme || readme);
  });
  return readme;
}

function cleanUpReadme(version) {
  if (_lodash.default.isNil(version) === false) {
    // @ts-ignore
    delete version.readme;
  }

  return version;
}

function normalizeContributors(contributors) {
  if (_lodash.default.isNil(contributors)) {
    return [];
  } else if (contributors && _lodash.default.isArray(contributors) === false) {
    // FIXME: this branch is clearly no an array, still tsc complains
    // @ts-ignore
    return [contributors];
  } else if (_lodash.default.isString(contributors)) {
    return [{
      name: contributors
    }];
  }

  return contributors;
}

const WHITELIST = ['_rev', 'name', 'versions', 'dist-tags', 'readme', 'time', '_id', 'users'];
exports.WHITELIST = WHITELIST;

function cleanUpLinksRef(keepUpLinkData, result) {
  const propertyToKeep = [...WHITELIST];

  if (keepUpLinkData === true) {
    propertyToKeep.push('_uplinks');
  }

  for (const i in result) {
    if (propertyToKeep.indexOf(i) === -1) {
      // Remove sections like '_uplinks' from response
      delete result[i];
    }
  }

  return result;
}
/**
 * Check whether a package it is already a local package
 * @param {*} name
 * @param {*} localStorage
 */


function checkPackageLocal(name, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.getPackageMetadata(name, (err, results) => {
      if (!_lodash.default.isNil(err) && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      }

      if (results) {
        return reject(_utils.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }

      return resolve();
    });
  });
}

function publishPackage(name, metadata, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.addPackage(name, metadata, (err, latest) => {
      if (!_lodash.default.isNull(err)) {
        return reject(err);
      } else if (!_lodash.default.isUndefined(latest)) {
        _search.default.add(latest);
      }

      return resolve();
    });
  });
}

function checkPackageRemote(name, isAllowPublishOffline, syncMetadata) {
  return new Promise((resolve, reject) => {
    syncMetadata(name, null, {}, (err, packageJsonLocal, upLinksErrors) => {
      // something weird
      if (err && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      } // checking package exist already


      if (_lodash.default.isNil(packageJsonLocal) === false) {
        return reject(_utils.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }

      for (let errorItem = 0; errorItem < upLinksErrors.length; errorItem++) {
        // checking error
        // if uplink fails with a status other than 404, we report failure
        if (_lodash.default.isNil(upLinksErrors[errorItem][0]) === false) {
          if (upLinksErrors[errorItem][0].status !== _constants.HTTP_STATUS.NOT_FOUND) {
            if (isAllowPublishOffline) {
              return resolve();
            }

            return reject(_utils.ErrorCode.getServiceUnavailable(_constants.API_ERROR.UPLINK_OFFLINE_PUBLISH));
          }
        }
      }

      return resolve();
    });
  });
}

function mergeUplinkTimeIntoLocal(localMetadata, remoteMetadata) {
  if ('time' in remoteMetadata) {
    return Object.assign({}, localMetadata.time, remoteMetadata.time);
  }

  return localMetadata.time;
}

function prepareSearchPackage(data, time) {
  const listVersions = Object.keys(data.versions);
  const versions = (0, _utils.semverSort)(listVersions);
  const latest = data[_constants.DIST_TAGS] && data[_constants.DIST_TAGS].latest ? data[_constants.DIST_TAGS].latest : versions.pop();

  if (latest && data.versions[latest]) {
    const version = data.versions[latest];
    const versions = {
      [latest]: 'latest'
    };
    const pkg = {
      name: version.name,
      description: version.description,
      [_constants.DIST_TAGS]: {
        latest
      },
      maintainers: version.maintainers || [version.author].filter(Boolean),
      author: version.author,
      repository: version.repository,
      readmeFilename: version.readmeFilename || '',
      homepage: version.homepage,
      keywords: version.keywords,
      bugs: version.bugs,
      license: version.license,
      time: {
        modified: time
      },
      versions
    };
    return pkg;
  }
}
/**
 * Check whether the package metadta has enough data to be published
 * @param pkg metadata
 */


function isPublishablePackage(pkg) {
  const keys = Object.keys(pkg);
  return _lodash.default.includes(keys, 'versions');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZSIsIm5hbWUiLCJ2ZXJzaW9ucyIsInRpbWUiLCJVU0VSUyIsIkRJU1RfVEFHUyIsIl91cGxpbmtzIiwiX2Rpc3RmaWxlcyIsIl9hdHRhY2htZW50cyIsIl9yZXYiLCJub3JtYWxpemVQYWNrYWdlIiwicGtnIiwicGtnUHJvcGVydGllcyIsImZvckVhY2giLCJrZXkiLCJwa2dQcm9wIiwiXyIsImlzTmlsIiwiaXNTdHJpbmciLCJTVE9SQUdFIiwiREVGQVVMVF9SRVZJU0lPTiIsIl9pZCIsImdlbmVyYXRlUmV2aXNpb24iLCJyZXYiLCJzcGxpdCIsImdldExhdGVzdFJlYWRtZSIsImRpc3RUYWdzIiwibGF0ZXN0VmVyc2lvbiIsInJlYWRtZSIsInRyaW0iLCJyZWFkbWVEaXN0VGFnc1ByaW9yaXR5IiwibWFwIiwidGFnIiwidmVyc2lvbiIsImNsZWFuVXBSZWFkbWUiLCJub3JtYWxpemVDb250cmlidXRvcnMiLCJjb250cmlidXRvcnMiLCJpc0FycmF5IiwiV0hJVEVMSVNUIiwiY2xlYW5VcExpbmtzUmVmIiwia2VlcFVwTGlua0RhdGEiLCJyZXN1bHQiLCJwcm9wZXJ0eVRvS2VlcCIsInB1c2giLCJpIiwiaW5kZXhPZiIsImNoZWNrUGFja2FnZUxvY2FsIiwibG9jYWxTdG9yYWdlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJnZXRQYWNrYWdlTWV0YWRhdGEiLCJlcnIiLCJyZXN1bHRzIiwic3RhdHVzIiwiSFRUUF9TVEFUVVMiLCJOT1RfRk9VTkQiLCJFcnJvckNvZGUiLCJnZXRDb25mbGljdCIsIkFQSV9FUlJPUiIsIlBBQ0tBR0VfRVhJU1QiLCJwdWJsaXNoUGFja2FnZSIsIm1ldGFkYXRhIiwiYWRkUGFja2FnZSIsImxhdGVzdCIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiU2VhcmNoIiwiYWRkIiwiY2hlY2tQYWNrYWdlUmVtb3RlIiwiaXNBbGxvd1B1Ymxpc2hPZmZsaW5lIiwic3luY01ldGFkYXRhIiwicGFja2FnZUpzb25Mb2NhbCIsInVwTGlua3NFcnJvcnMiLCJlcnJvckl0ZW0iLCJsZW5ndGgiLCJnZXRTZXJ2aWNlVW5hdmFpbGFibGUiLCJVUExJTktfT0ZGTElORV9QVUJMSVNIIiwibWVyZ2VVcGxpbmtUaW1lSW50b0xvY2FsIiwibG9jYWxNZXRhZGF0YSIsInJlbW90ZU1ldGFkYXRhIiwiT2JqZWN0IiwiYXNzaWduIiwicHJlcGFyZVNlYXJjaFBhY2thZ2UiLCJkYXRhIiwibGlzdFZlcnNpb25zIiwia2V5cyIsInBvcCIsImRlc2NyaXB0aW9uIiwibWFpbnRhaW5lcnMiLCJhdXRob3IiLCJmaWx0ZXIiLCJCb29sZWFuIiwicmVwb3NpdG9yeSIsInJlYWRtZUZpbGVuYW1lIiwiaG9tZXBhZ2UiLCJrZXl3b3JkcyIsImJ1Z3MiLCJsaWNlbnNlIiwibW9kaWZpZWQiLCJpc1B1Ymxpc2hhYmxlUGFja2FnZSIsImluY2x1ZGVzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9zdG9yYWdlLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IEF1dGhvciwgUGFja2FnZSwgVmVyc2lvbiB9IGZyb20gJ0B2ZXJkYWNjaW8vdHlwZXMnO1xuXG5pbXBvcnQgeyBJU3RvcmFnZSB9IGZyb20gJy4uLy4uL3R5cGVzJztcbmltcG9ydCB7IGdlbmVyYXRlUmFuZG9tSGV4U3RyaW5nIH0gZnJvbSAnLi4vbGliL2NyeXB0by11dGlscyc7XG5pbXBvcnQgeyBBUElfRVJST1IsIERJU1RfVEFHUywgSFRUUF9TVEFUVVMsIFNUT1JBR0UsIFVTRVJTIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IFNlYXJjaCBmcm9tICcuL3NlYXJjaCc7XG5pbXBvcnQgeyBFcnJvckNvZGUsIGlzT2JqZWN0LCBub3JtYWxpemVEaXN0VGFncywgc2VtdmVyU29ydCB9IGZyb20gJy4vdXRpbHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVQYWNrYWdlVGVtcGxhdGUobmFtZTogc3RyaW5nKTogUGFja2FnZSB7XG4gIHJldHVybiB7XG4gICAgLy8gc3RhbmRhcmQgdGhpbmdzXG4gICAgbmFtZSxcbiAgICB2ZXJzaW9uczoge30sXG4gICAgdGltZToge30sXG4gICAgW1VTRVJTXToge30sXG4gICAgW0RJU1RfVEFHU106IHt9LFxuICAgIF91cGxpbmtzOiB7fSxcbiAgICBfZGlzdGZpbGVzOiB7fSxcbiAgICBfYXR0YWNobWVudHM6IHt9LFxuICAgIF9yZXY6ICcnLFxuICB9O1xufVxuXG4vKipcbiAqIE5vcm1hbGl6ZSBwYWNrYWdlIHByb3BlcnRpZXMsIHRhZ3MsIHJldmlzaW9uIGlkLlxuICogQHBhcmFtIHtPYmplY3R9IHBrZyBwYWNrYWdlIHJlZmVyZW5jZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVBhY2thZ2UocGtnOiBQYWNrYWdlKTogUGFja2FnZSB7XG4gIGNvbnN0IHBrZ1Byb3BlcnRpZXMgPSBbJ3ZlcnNpb25zJywgJ2Rpc3QtdGFncycsICdfZGlzdGZpbGVzJywgJ19hdHRhY2htZW50cycsICdfdXBsaW5rcycsICd0aW1lJ107XG5cbiAgcGtnUHJvcGVydGllcy5mb3JFYWNoKChrZXkpOiB2b2lkID0+IHtcbiAgICBjb25zdCBwa2dQcm9wID0gcGtnW2tleV07XG5cbiAgICBpZiAoXy5pc05pbChwa2dQcm9wKSB8fCBpc09iamVjdChwa2dQcm9wKSA9PT0gZmFsc2UpIHtcbiAgICAgIHBrZ1trZXldID0ge307XG4gICAgfVxuICB9KTtcblxuICBpZiAoXy5pc1N0cmluZyhwa2cuX3JldikgPT09IGZhbHNlKSB7XG4gICAgcGtnLl9yZXYgPSBTVE9SQUdFLkRFRkFVTFRfUkVWSVNJT047XG4gIH1cblxuICBpZiAoXy5pc1N0cmluZyhwa2cuX2lkKSA9PT0gZmFsc2UpIHtcbiAgICBwa2cuX2lkID0gcGtnLm5hbWU7XG4gIH1cblxuICAvLyBub3JtYWxpemUgZGlzdC10YWdzXG4gIG5vcm1hbGl6ZURpc3RUYWdzKHBrZyk7XG5cbiAgcmV0dXJuIHBrZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlUmV2aXNpb24ocmV2OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBfcmV2ID0gcmV2LnNwbGl0KCctJyk7XG5cbiAgcmV0dXJuICgrX3JldlswXSB8fCAwKSArIDEgKyAnLScgKyBnZW5lcmF0ZVJhbmRvbUhleFN0cmluZygpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGF0ZXN0UmVhZG1lKHBrZzogUGFja2FnZSk6IHN0cmluZyB7XG4gIGNvbnN0IHZlcnNpb25zID0gcGtnWyd2ZXJzaW9ucyddIHx8IHt9O1xuICBjb25zdCBkaXN0VGFncyA9IHBrZ1tESVNUX1RBR1NdIHx8IHt9O1xuICAvLyBGSVhNRTogaGVyZSBpcyBhIGJpdCB0cmlja3kgYWRkIHRoZSB0eXBlc1xuICBjb25zdCBsYXRlc3RWZXJzaW9uOiBWZXJzaW9uIHwgYW55ID0gZGlzdFRhZ3NbJ2xhdGVzdCddID8gdmVyc2lvbnNbZGlzdFRhZ3NbJ2xhdGVzdCddXSB8fCB7fSA6IHt9O1xuICBsZXQgcmVhZG1lID0gXy50cmltKHBrZy5yZWFkbWUgfHwgbGF0ZXN0VmVyc2lvbi5yZWFkbWUgfHwgJycpO1xuICBpZiAocmVhZG1lKSB7XG4gICAgcmV0dXJuIHJlYWRtZTtcbiAgfVxuXG4gIC8vIEluIGNhc2Ugb2YgZW1wdHkgcmVhZG1lIC0gdHJ5aW5nIHRvIGdldCBBTlkgcmVhZG1lIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6ICduZXh0JywnYmV0YScsJ2FscGhhJywndGVzdCcsJ2RldicsJ2NhbmFyeSdcbiAgY29uc3QgcmVhZG1lRGlzdFRhZ3NQcmlvcml0eSA9IFsnbmV4dCcsICdiZXRhJywgJ2FscGhhJywgJ3Rlc3QnLCAnZGV2JywgJ2NhbmFyeSddO1xuICByZWFkbWVEaXN0VGFnc1ByaW9yaXR5Lm1hcChmdW5jdGlvbiAodGFnKTogc3RyaW5nIHwgdm9pZCB7XG4gICAgaWYgKHJlYWRtZSkge1xuICAgICAgcmV0dXJuIHJlYWRtZTtcbiAgICB9XG4gICAgY29uc3QgdmVyc2lvbjogVmVyc2lvbiB8IGFueSA9IGRpc3RUYWdzW3RhZ10gPyB2ZXJzaW9uc1tkaXN0VGFnc1t0YWddXSB8fCB7fSA6IHt9O1xuICAgIHJlYWRtZSA9IF8udHJpbSh2ZXJzaW9uLnJlYWRtZSB8fCByZWFkbWUpO1xuICB9KTtcbiAgcmV0dXJuIHJlYWRtZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuVXBSZWFkbWUodmVyc2lvbjogVmVyc2lvbik6IFZlcnNpb24ge1xuICBpZiAoXy5pc05pbCh2ZXJzaW9uKSA9PT0gZmFsc2UpIHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZGVsZXRlIHZlcnNpb24ucmVhZG1lO1xuICB9XG5cbiAgcmV0dXJuIHZlcnNpb247XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVDb250cmlidXRvcnMoY29udHJpYnV0b3JzOiBBdXRob3JbXSk6IEF1dGhvcltdIHtcbiAgaWYgKF8uaXNOaWwoY29udHJpYnV0b3JzKSkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIGlmIChjb250cmlidXRvcnMgJiYgXy5pc0FycmF5KGNvbnRyaWJ1dG9ycykgPT09IGZhbHNlKSB7XG4gICAgLy8gRklYTUU6IHRoaXMgYnJhbmNoIGlzIGNsZWFybHkgbm8gYW4gYXJyYXksIHN0aWxsIHRzYyBjb21wbGFpbnNcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmV0dXJuIFtjb250cmlidXRvcnNdO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoY29udHJpYnV0b3JzKSkge1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6IGNvbnRyaWJ1dG9ycyxcbiAgICAgIH0sXG4gICAgXTtcbiAgfVxuXG4gIHJldHVybiBjb250cmlidXRvcnM7XG59XG5cbmV4cG9ydCBjb25zdCBXSElURUxJU1QgPSBbJ19yZXYnLCAnbmFtZScsICd2ZXJzaW9ucycsICdkaXN0LXRhZ3MnLCAncmVhZG1lJywgJ3RpbWUnLCAnX2lkJywgJ3VzZXJzJ107XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhblVwTGlua3NSZWYoa2VlcFVwTGlua0RhdGE6IGJvb2xlYW4sIHJlc3VsdDogUGFja2FnZSk6IFBhY2thZ2Uge1xuICBjb25zdCBwcm9wZXJ0eVRvS2VlcCA9IFsuLi5XSElURUxJU1RdO1xuICBpZiAoa2VlcFVwTGlua0RhdGEgPT09IHRydWUpIHtcbiAgICBwcm9wZXJ0eVRvS2VlcC5wdXNoKCdfdXBsaW5rcycpO1xuICB9XG5cbiAgZm9yIChjb25zdCBpIGluIHJlc3VsdCkge1xuICAgIGlmIChwcm9wZXJ0eVRvS2VlcC5pbmRleE9mKGkpID09PSAtMSkge1xuICAgICAgLy8gUmVtb3ZlIHNlY3Rpb25zIGxpa2UgJ191cGxpbmtzJyBmcm9tIHJlc3BvbnNlXG4gICAgICBkZWxldGUgcmVzdWx0W2ldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciBhIHBhY2thZ2UgaXQgaXMgYWxyZWFkeSBhIGxvY2FsIHBhY2thZ2VcbiAqIEBwYXJhbSB7Kn0gbmFtZVxuICogQHBhcmFtIHsqfSBsb2NhbFN0b3JhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUGFja2FnZUxvY2FsKG5hbWU6IHN0cmluZywgbG9jYWxTdG9yYWdlOiBJU3RvcmFnZSk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5nZXRQYWNrYWdlTWV0YWRhdGEobmFtZSwgKGVyciwgcmVzdWx0cyk6IHZvaWQgPT4ge1xuICAgICAgaWYgKCFfLmlzTmlsKGVycikgJiYgZXJyLnN0YXR1cyAhPT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoRXJyb3JDb2RlLmdldENvbmZsaWN0KEFQSV9FUlJPUi5QQUNLQUdFX0VYSVNUKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHB1Ymxpc2hQYWNrYWdlKG5hbWU6IHN0cmluZywgbWV0YWRhdGE6IGFueSwgbG9jYWxTdG9yYWdlOiBJU3RvcmFnZSk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5hZGRQYWNrYWdlKG5hbWUsIG1ldGFkYXRhLCAoZXJyLCBsYXRlc3QpOiB2b2lkID0+IHtcbiAgICAgIGlmICghXy5pc051bGwoZXJyKSkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9IGVsc2UgaWYgKCFfLmlzVW5kZWZpbmVkKGxhdGVzdCkpIHtcbiAgICAgICAgU2VhcmNoLmFkZChsYXRlc3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGVja1BhY2thZ2VSZW1vdGUobmFtZTogc3RyaW5nLCBpc0FsbG93UHVibGlzaE9mZmxpbmU6IGJvb2xlYW4sIHN5bmNNZXRhZGF0YTogRnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpOiB2b2lkID0+IHtcbiAgICBzeW5jTWV0YWRhdGEobmFtZSwgbnVsbCwge30sIChlcnIsIHBhY2thZ2VKc29uTG9jYWwsIHVwTGlua3NFcnJvcnMpOiB2b2lkID0+IHtcbiAgICAgIC8vIHNvbWV0aGluZyB3ZWlyZFxuICAgICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzICE9PSBIVFRQX1NUQVRVUy5OT1RfRk9VTkQpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgfVxuXG4gICAgICAvLyBjaGVja2luZyBwYWNrYWdlIGV4aXN0IGFscmVhZHlcbiAgICAgIGlmIChfLmlzTmlsKHBhY2thZ2VKc29uTG9jYWwpID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KEVycm9yQ29kZS5nZXRDb25mbGljdChBUElfRVJST1IuUEFDS0FHRV9FWElTVCkpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBlcnJvckl0ZW0gPSAwOyBlcnJvckl0ZW0gPCB1cExpbmtzRXJyb3JzLmxlbmd0aDsgZXJyb3JJdGVtKyspIHtcbiAgICAgICAgLy8gY2hlY2tpbmcgZXJyb3JcbiAgICAgICAgLy8gaWYgdXBsaW5rIGZhaWxzIHdpdGggYSBzdGF0dXMgb3RoZXIgdGhhbiA0MDQsIHdlIHJlcG9ydCBmYWlsdXJlXG4gICAgICAgIGlmIChfLmlzTmlsKHVwTGlua3NFcnJvcnNbZXJyb3JJdGVtXVswXSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgaWYgKHVwTGlua3NFcnJvcnNbZXJyb3JJdGVtXVswXS5zdGF0dXMgIT09IEhUVFBfU1RBVFVTLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgaWYgKGlzQWxsb3dQdWJsaXNoT2ZmbGluZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KEVycm9yQ29kZS5nZXRTZXJ2aWNlVW5hdmFpbGFibGUoQVBJX0VSUk9SLlVQTElOS19PRkZMSU5FX1BVQkxJU0gpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZVVwbGlua1RpbWVJbnRvTG9jYWwobG9jYWxNZXRhZGF0YTogUGFja2FnZSwgcmVtb3RlTWV0YWRhdGE6IFBhY2thZ2UpOiBhbnkge1xuICBpZiAoJ3RpbWUnIGluIHJlbW90ZU1ldGFkYXRhKSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGxvY2FsTWV0YWRhdGEudGltZSwgcmVtb3RlTWV0YWRhdGEudGltZSk7XG4gIH1cblxuICByZXR1cm4gbG9jYWxNZXRhZGF0YS50aW1lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZVNlYXJjaFBhY2thZ2UoZGF0YTogUGFja2FnZSwgdGltZTogdW5rbm93bik6IGFueSB7XG4gIGNvbnN0IGxpc3RWZXJzaW9uczogc3RyaW5nW10gPSBPYmplY3Qua2V5cyhkYXRhLnZlcnNpb25zKTtcbiAgY29uc3QgdmVyc2lvbnM6IHN0cmluZ1tdID0gc2VtdmVyU29ydChsaXN0VmVyc2lvbnMpO1xuICBjb25zdCBsYXRlc3Q6IHN0cmluZyB8IHVuZGVmaW5lZCA9IGRhdGFbRElTVF9UQUdTXSAmJiBkYXRhW0RJU1RfVEFHU10ubGF0ZXN0ID8gZGF0YVtESVNUX1RBR1NdLmxhdGVzdCA6IHZlcnNpb25zLnBvcCgpO1xuXG4gIGlmIChsYXRlc3QgJiYgZGF0YS52ZXJzaW9uc1tsYXRlc3RdKSB7XG4gICAgY29uc3QgdmVyc2lvbjogVmVyc2lvbiA9IGRhdGEudmVyc2lvbnNbbGF0ZXN0XTtcbiAgICBjb25zdCB2ZXJzaW9uczogYW55ID0geyBbbGF0ZXN0XTogJ2xhdGVzdCcgfTtcbiAgICBjb25zdCBwa2c6IGFueSA9IHtcbiAgICAgIG5hbWU6IHZlcnNpb24ubmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB2ZXJzaW9uLmRlc2NyaXB0aW9uLFxuICAgICAgW0RJU1RfVEFHU106IHsgbGF0ZXN0IH0sXG4gICAgICBtYWludGFpbmVyczogdmVyc2lvbi5tYWludGFpbmVycyB8fCBbdmVyc2lvbi5hdXRob3JdLmZpbHRlcihCb29sZWFuKSxcbiAgICAgIGF1dGhvcjogdmVyc2lvbi5hdXRob3IsXG4gICAgICByZXBvc2l0b3J5OiB2ZXJzaW9uLnJlcG9zaXRvcnksXG4gICAgICByZWFkbWVGaWxlbmFtZTogdmVyc2lvbi5yZWFkbWVGaWxlbmFtZSB8fCAnJyxcbiAgICAgIGhvbWVwYWdlOiB2ZXJzaW9uLmhvbWVwYWdlLFxuICAgICAga2V5d29yZHM6IHZlcnNpb24ua2V5d29yZHMsXG4gICAgICBidWdzOiB2ZXJzaW9uLmJ1Z3MsXG4gICAgICBsaWNlbnNlOiB2ZXJzaW9uLmxpY2Vuc2UsXG4gICAgICB0aW1lOiB7XG4gICAgICAgIG1vZGlmaWVkOiB0aW1lLFxuICAgICAgfSxcbiAgICAgIHZlcnNpb25zLFxuICAgIH07XG5cbiAgICByZXR1cm4gcGtnO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGUgcGFja2FnZSBtZXRhZHRhIGhhcyBlbm91Z2ggZGF0YSB0byBiZSBwdWJsaXNoZWRcbiAqIEBwYXJhbSBwa2cgbWV0YWRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUHVibGlzaGFibGVQYWNrYWdlKHBrZzogUGFja2FnZSk6IGJvb2xlYW4ge1xuICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IE9iamVjdC5rZXlzKHBrZyk7XG5cbiAgcmV0dXJuIF8uaW5jbHVkZXMoa2V5cywgJ3ZlcnNpb25zJyk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBS0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFTyxTQUFTQSx1QkFBVCxDQUFpQ0MsSUFBakMsRUFBd0Q7RUFDN0QsT0FBTztJQUNMO0lBQ0FBLElBRks7SUFHTEMsUUFBUSxFQUFFLEVBSEw7SUFJTEMsSUFBSSxFQUFFLEVBSkQ7SUFLTCxDQUFDQyxnQkFBRCxHQUFTLEVBTEo7SUFNTCxDQUFDQyxvQkFBRCxHQUFhLEVBTlI7SUFPTEMsUUFBUSxFQUFFLEVBUEw7SUFRTEMsVUFBVSxFQUFFLEVBUlA7SUFTTEMsWUFBWSxFQUFFLEVBVFQ7SUFVTEMsSUFBSSxFQUFFO0VBVkQsQ0FBUDtBQVlEO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7OztBQUNPLFNBQVNDLGdCQUFULENBQTBCQyxHQUExQixFQUFpRDtFQUN0RCxNQUFNQyxhQUFhLEdBQUcsQ0FBQyxVQUFELEVBQWEsV0FBYixFQUEwQixZQUExQixFQUF3QyxjQUF4QyxFQUF3RCxVQUF4RCxFQUFvRSxNQUFwRSxDQUF0QjtFQUVBQSxhQUFhLENBQUNDLE9BQWQsQ0FBdUJDLEdBQUQsSUFBZTtJQUNuQyxNQUFNQyxPQUFPLEdBQUdKLEdBQUcsQ0FBQ0csR0FBRCxDQUFuQjs7SUFFQSxJQUFJRSxnQkFBRUMsS0FBRixDQUFRRixPQUFSLEtBQW9CLHFCQUFTQSxPQUFULE1BQXNCLEtBQTlDLEVBQXFEO01BQ25ESixHQUFHLENBQUNHLEdBQUQsQ0FBSCxHQUFXLEVBQVg7SUFDRDtFQUNGLENBTkQ7O0VBUUEsSUFBSUUsZ0JBQUVFLFFBQUYsQ0FBV1AsR0FBRyxDQUFDRixJQUFmLE1BQXlCLEtBQTdCLEVBQW9DO0lBQ2xDRSxHQUFHLENBQUNGLElBQUosR0FBV1UsbUJBQVFDLGdCQUFuQjtFQUNEOztFQUVELElBQUlKLGdCQUFFRSxRQUFGLENBQVdQLEdBQUcsQ0FBQ1UsR0FBZixNQUF3QixLQUE1QixFQUFtQztJQUNqQ1YsR0FBRyxDQUFDVSxHQUFKLEdBQVVWLEdBQUcsQ0FBQ1YsSUFBZDtFQUNELENBakJxRCxDQW1CdEQ7OztFQUNBLDhCQUFrQlUsR0FBbEI7RUFFQSxPQUFPQSxHQUFQO0FBQ0Q7O0FBRU0sU0FBU1csZ0JBQVQsQ0FBMEJDLEdBQTFCLEVBQStDO0VBQ3BELE1BQU1kLElBQUksR0FBR2MsR0FBRyxDQUFDQyxLQUFKLENBQVUsR0FBVixDQUFiOztFQUVBLE9BQU8sQ0FBQyxDQUFDZixJQUFJLENBQUMsQ0FBRCxDQUFMLElBQVksQ0FBYixJQUFrQixDQUFsQixHQUFzQixHQUF0QixHQUE0QiwyQ0FBbkM7QUFDRDs7QUFFTSxTQUFTZ0IsZUFBVCxDQUF5QmQsR0FBekIsRUFBK0M7RUFDcEQsTUFBTVQsUUFBUSxHQUFHUyxHQUFHLENBQUMsVUFBRCxDQUFILElBQW1CLEVBQXBDO0VBQ0EsTUFBTWUsUUFBUSxHQUFHZixHQUFHLENBQUNOLG9CQUFELENBQUgsSUFBa0IsRUFBbkMsQ0FGb0QsQ0FHcEQ7O0VBQ0EsTUFBTXNCLGFBQTRCLEdBQUdELFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUJ4QixRQUFRLENBQUN3QixRQUFRLENBQUMsUUFBRCxDQUFULENBQVIsSUFBZ0MsRUFBckQsR0FBMEQsRUFBL0Y7O0VBQ0EsSUFBSUUsTUFBTSxHQUFHWixnQkFBRWEsSUFBRixDQUFPbEIsR0FBRyxDQUFDaUIsTUFBSixJQUFjRCxhQUFhLENBQUNDLE1BQTVCLElBQXNDLEVBQTdDLENBQWI7O0VBQ0EsSUFBSUEsTUFBSixFQUFZO0lBQ1YsT0FBT0EsTUFBUDtFQUNELENBUm1ELENBVXBEOzs7RUFDQSxNQUFNRSxzQkFBc0IsR0FBRyxDQUFDLE1BQUQsRUFBUyxNQUFULEVBQWlCLE9BQWpCLEVBQTBCLE1BQTFCLEVBQWtDLEtBQWxDLEVBQXlDLFFBQXpDLENBQS9CO0VBQ0FBLHNCQUFzQixDQUFDQyxHQUF2QixDQUEyQixVQUFVQyxHQUFWLEVBQThCO0lBQ3ZELElBQUlKLE1BQUosRUFBWTtNQUNWLE9BQU9BLE1BQVA7SUFDRDs7SUFDRCxNQUFNSyxPQUFzQixHQUFHUCxRQUFRLENBQUNNLEdBQUQsQ0FBUixHQUFnQjlCLFFBQVEsQ0FBQ3dCLFFBQVEsQ0FBQ00sR0FBRCxDQUFULENBQVIsSUFBMkIsRUFBM0MsR0FBZ0QsRUFBL0U7SUFDQUosTUFBTSxHQUFHWixnQkFBRWEsSUFBRixDQUFPSSxPQUFPLENBQUNMLE1BQVIsSUFBa0JBLE1BQXpCLENBQVQ7RUFDRCxDQU5EO0VBT0EsT0FBT0EsTUFBUDtBQUNEOztBQUVNLFNBQVNNLGFBQVQsQ0FBdUJELE9BQXZCLEVBQWtEO0VBQ3ZELElBQUlqQixnQkFBRUMsS0FBRixDQUFRZ0IsT0FBUixNQUFxQixLQUF6QixFQUFnQztJQUM5QjtJQUNBLE9BQU9BLE9BQU8sQ0FBQ0wsTUFBZjtFQUNEOztFQUVELE9BQU9LLE9BQVA7QUFDRDs7QUFFTSxTQUFTRSxxQkFBVCxDQUErQkMsWUFBL0IsRUFBaUU7RUFDdEUsSUFBSXBCLGdCQUFFQyxLQUFGLENBQVFtQixZQUFSLENBQUosRUFBMkI7SUFDekIsT0FBTyxFQUFQO0VBQ0QsQ0FGRCxNQUVPLElBQUlBLFlBQVksSUFBSXBCLGdCQUFFcUIsT0FBRixDQUFVRCxZQUFWLE1BQTRCLEtBQWhELEVBQXVEO0lBQzVEO0lBQ0E7SUFDQSxPQUFPLENBQUNBLFlBQUQsQ0FBUDtFQUNELENBSk0sTUFJQSxJQUFJcEIsZ0JBQUVFLFFBQUYsQ0FBV2tCLFlBQVgsQ0FBSixFQUE4QjtJQUNuQyxPQUFPLENBQ0w7TUFDRW5DLElBQUksRUFBRW1DO0lBRFIsQ0FESyxDQUFQO0VBS0Q7O0VBRUQsT0FBT0EsWUFBUDtBQUNEOztBQUVNLE1BQU1FLFNBQVMsR0FBRyxDQUFDLE1BQUQsRUFBUyxNQUFULEVBQWlCLFVBQWpCLEVBQTZCLFdBQTdCLEVBQTBDLFFBQTFDLEVBQW9ELE1BQXBELEVBQTRELEtBQTVELEVBQW1FLE9BQW5FLENBQWxCOzs7QUFFQSxTQUFTQyxlQUFULENBQXlCQyxjQUF6QixFQUFrREMsTUFBbEQsRUFBNEU7RUFDakYsTUFBTUMsY0FBYyxHQUFHLENBQUMsR0FBR0osU0FBSixDQUF2Qjs7RUFDQSxJQUFJRSxjQUFjLEtBQUssSUFBdkIsRUFBNkI7SUFDM0JFLGNBQWMsQ0FBQ0MsSUFBZixDQUFvQixVQUFwQjtFQUNEOztFQUVELEtBQUssTUFBTUMsQ0FBWCxJQUFnQkgsTUFBaEIsRUFBd0I7SUFDdEIsSUFBSUMsY0FBYyxDQUFDRyxPQUFmLENBQXVCRCxDQUF2QixNQUE4QixDQUFDLENBQW5DLEVBQXNDO01BQ3BDO01BQ0EsT0FBT0gsTUFBTSxDQUFDRyxDQUFELENBQWI7SUFDRDtFQUNGOztFQUVELE9BQU9ILE1BQVA7QUFDRDtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNPLFNBQVNLLGlCQUFULENBQTJCN0MsSUFBM0IsRUFBeUM4QyxZQUF6QyxFQUFnRjtFQUNyRixPQUFPLElBQUlDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBMkI7SUFDNUNILFlBQVksQ0FBQ0ksa0JBQWIsQ0FBZ0NsRCxJQUFoQyxFQUFzQyxDQUFDbUQsR0FBRCxFQUFNQyxPQUFOLEtBQXdCO01BQzVELElBQUksQ0FBQ3JDLGdCQUFFQyxLQUFGLENBQVFtQyxHQUFSLENBQUQsSUFBaUJBLEdBQUcsQ0FBQ0UsTUFBSixLQUFlQyx1QkFBWUMsU0FBaEQsRUFBMkQ7UUFDekQsT0FBT04sTUFBTSxDQUFDRSxHQUFELENBQWI7TUFDRDs7TUFDRCxJQUFJQyxPQUFKLEVBQWE7UUFDWCxPQUFPSCxNQUFNLENBQUNPLGlCQUFVQyxXQUFWLENBQXNCQyxxQkFBVUMsYUFBaEMsQ0FBRCxDQUFiO01BQ0Q7O01BQ0QsT0FBT1gsT0FBTyxFQUFkO0lBQ0QsQ0FSRDtFQVNELENBVk0sQ0FBUDtBQVdEOztBQUVNLFNBQVNZLGNBQVQsQ0FBd0I1RCxJQUF4QixFQUFzQzZELFFBQXRDLEVBQXFEZixZQUFyRCxFQUE0RjtFQUNqRyxPQUFPLElBQUlDLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBMkI7SUFDNUNILFlBQVksQ0FBQ2dCLFVBQWIsQ0FBd0I5RCxJQUF4QixFQUE4QjZELFFBQTlCLEVBQXdDLENBQUNWLEdBQUQsRUFBTVksTUFBTixLQUF1QjtNQUM3RCxJQUFJLENBQUNoRCxnQkFBRWlELE1BQUYsQ0FBU2IsR0FBVCxDQUFMLEVBQW9CO1FBQ2xCLE9BQU9GLE1BQU0sQ0FBQ0UsR0FBRCxDQUFiO01BQ0QsQ0FGRCxNQUVPLElBQUksQ0FBQ3BDLGdCQUFFa0QsV0FBRixDQUFjRixNQUFkLENBQUwsRUFBNEI7UUFDakNHLGdCQUFPQyxHQUFQLENBQVdKLE1BQVg7TUFDRDs7TUFDRCxPQUFPZixPQUFPLEVBQWQ7SUFDRCxDQVBEO0VBUUQsQ0FUTSxDQUFQO0FBVUQ7O0FBRU0sU0FBU29CLGtCQUFULENBQTRCcEUsSUFBNUIsRUFBMENxRSxxQkFBMUMsRUFBMEVDLFlBQTFFLEVBQWlIO0VBQ3RILE9BQU8sSUFBSXZCLE9BQUosQ0FBWSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBMkI7SUFDNUNxQixZQUFZLENBQUN0RSxJQUFELEVBQU8sSUFBUCxFQUFhLEVBQWIsRUFBaUIsQ0FBQ21ELEdBQUQsRUFBTW9CLGdCQUFOLEVBQXdCQyxhQUF4QixLQUFnRDtNQUMzRTtNQUNBLElBQUlyQixHQUFHLElBQUlBLEdBQUcsQ0FBQ0UsTUFBSixLQUFlQyx1QkFBWUMsU0FBdEMsRUFBaUQ7UUFDL0MsT0FBT04sTUFBTSxDQUFDRSxHQUFELENBQWI7TUFDRCxDQUowRSxDQU0zRTs7O01BQ0EsSUFBSXBDLGdCQUFFQyxLQUFGLENBQVF1RCxnQkFBUixNQUE4QixLQUFsQyxFQUF5QztRQUN2QyxPQUFPdEIsTUFBTSxDQUFDTyxpQkFBVUMsV0FBVixDQUFzQkMscUJBQVVDLGFBQWhDLENBQUQsQ0FBYjtNQUNEOztNQUVELEtBQUssSUFBSWMsU0FBUyxHQUFHLENBQXJCLEVBQXdCQSxTQUFTLEdBQUdELGFBQWEsQ0FBQ0UsTUFBbEQsRUFBMERELFNBQVMsRUFBbkUsRUFBdUU7UUFDckU7UUFDQTtRQUNBLElBQUkxRCxnQkFBRUMsS0FBRixDQUFRd0QsYUFBYSxDQUFDQyxTQUFELENBQWIsQ0FBeUIsQ0FBekIsQ0FBUixNQUF5QyxLQUE3QyxFQUFvRDtVQUNsRCxJQUFJRCxhQUFhLENBQUNDLFNBQUQsQ0FBYixDQUF5QixDQUF6QixFQUE0QnBCLE1BQTVCLEtBQXVDQyx1QkFBWUMsU0FBdkQsRUFBa0U7WUFDaEUsSUFBSWMscUJBQUosRUFBMkI7Y0FDekIsT0FBT3JCLE9BQU8sRUFBZDtZQUNEOztZQUVELE9BQU9DLE1BQU0sQ0FBQ08saUJBQVVtQixxQkFBVixDQUFnQ2pCLHFCQUFVa0Isc0JBQTFDLENBQUQsQ0FBYjtVQUNEO1FBQ0Y7TUFDRjs7TUFFRCxPQUFPNUIsT0FBTyxFQUFkO0lBQ0QsQ0ExQlcsQ0FBWjtFQTJCRCxDQTVCTSxDQUFQO0FBNkJEOztBQUVNLFNBQVM2Qix3QkFBVCxDQUFrQ0MsYUFBbEMsRUFBMERDLGNBQTFELEVBQXdGO0VBQzdGLElBQUksVUFBVUEsY0FBZCxFQUE4QjtJQUM1QixPQUFPQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCSCxhQUFhLENBQUM1RSxJQUFoQyxFQUFzQzZFLGNBQWMsQ0FBQzdFLElBQXJELENBQVA7RUFDRDs7RUFFRCxPQUFPNEUsYUFBYSxDQUFDNUUsSUFBckI7QUFDRDs7QUFFTSxTQUFTZ0Ysb0JBQVQsQ0FBOEJDLElBQTlCLEVBQTZDakYsSUFBN0MsRUFBaUU7RUFDdEUsTUFBTWtGLFlBQXNCLEdBQUdKLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZRixJQUFJLENBQUNsRixRQUFqQixDQUEvQjtFQUNBLE1BQU1BLFFBQWtCLEdBQUcsdUJBQVdtRixZQUFYLENBQTNCO0VBQ0EsTUFBTXJCLE1BQTBCLEdBQUdvQixJQUFJLENBQUMvRSxvQkFBRCxDQUFKLElBQW1CK0UsSUFBSSxDQUFDL0Usb0JBQUQsQ0FBSixDQUFnQjJELE1BQW5DLEdBQTRDb0IsSUFBSSxDQUFDL0Usb0JBQUQsQ0FBSixDQUFnQjJELE1BQTVELEdBQXFFOUQsUUFBUSxDQUFDcUYsR0FBVCxFQUF4Rzs7RUFFQSxJQUFJdkIsTUFBTSxJQUFJb0IsSUFBSSxDQUFDbEYsUUFBTCxDQUFjOEQsTUFBZCxDQUFkLEVBQXFDO0lBQ25DLE1BQU0vQixPQUFnQixHQUFHbUQsSUFBSSxDQUFDbEYsUUFBTCxDQUFjOEQsTUFBZCxDQUF6QjtJQUNBLE1BQU05RCxRQUFhLEdBQUc7TUFBRSxDQUFDOEQsTUFBRCxHQUFVO0lBQVosQ0FBdEI7SUFDQSxNQUFNckQsR0FBUSxHQUFHO01BQ2ZWLElBQUksRUFBRWdDLE9BQU8sQ0FBQ2hDLElBREM7TUFFZnVGLFdBQVcsRUFBRXZELE9BQU8sQ0FBQ3VELFdBRk47TUFHZixDQUFDbkYsb0JBQUQsR0FBYTtRQUFFMkQ7TUFBRixDQUhFO01BSWZ5QixXQUFXLEVBQUV4RCxPQUFPLENBQUN3RCxXQUFSLElBQXVCLENBQUN4RCxPQUFPLENBQUN5RCxNQUFULEVBQWlCQyxNQUFqQixDQUF3QkMsT0FBeEIsQ0FKckI7TUFLZkYsTUFBTSxFQUFFekQsT0FBTyxDQUFDeUQsTUFMRDtNQU1mRyxVQUFVLEVBQUU1RCxPQUFPLENBQUM0RCxVQU5MO01BT2ZDLGNBQWMsRUFBRTdELE9BQU8sQ0FBQzZELGNBQVIsSUFBMEIsRUFQM0I7TUFRZkMsUUFBUSxFQUFFOUQsT0FBTyxDQUFDOEQsUUFSSDtNQVNmQyxRQUFRLEVBQUUvRCxPQUFPLENBQUMrRCxRQVRIO01BVWZDLElBQUksRUFBRWhFLE9BQU8sQ0FBQ2dFLElBVkM7TUFXZkMsT0FBTyxFQUFFakUsT0FBTyxDQUFDaUUsT0FYRjtNQVlmL0YsSUFBSSxFQUFFO1FBQ0pnRyxRQUFRLEVBQUVoRztNQUROLENBWlM7TUFlZkQ7SUFmZSxDQUFqQjtJQWtCQSxPQUFPUyxHQUFQO0VBQ0Q7QUFDRjtBQUVEO0FBQ0E7QUFDQTtBQUNBOzs7QUFDTyxTQUFTeUYsb0JBQVQsQ0FBOEJ6RixHQUE5QixFQUFxRDtFQUMxRCxNQUFNMkUsSUFBYyxHQUFHTCxNQUFNLENBQUNLLElBQVAsQ0FBWTNFLEdBQVosQ0FBdkI7RUFFQSxPQUFPSyxnQkFBRXFGLFFBQUYsQ0FBV2YsSUFBWCxFQUFpQixVQUFqQixDQUFQO0FBQ0QifQ==