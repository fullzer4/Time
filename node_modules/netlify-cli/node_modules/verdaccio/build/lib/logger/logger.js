"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createLogger = createLogger;
exports.getLogger = getLogger;
exports.logger = void 0;
exports.setup = setup;

var _debug = _interopRequireDefault(require("debug"));

var _lodash = _interopRequireDefault(require("lodash"));

var _pino = _interopRequireDefault(require("pino"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function isProd() {
  return process.env.NODE_ENV === 'production';
}

let logger;
exports.logger = logger;
const debug = (0, _debug.default)('verdaccio:logger');
const DEFAULT_LOG_FORMAT = isProd() ? 'json' : 'pretty';

function createLogger(options = {
  level: 'http'
}, destination = _pino.default.destination(1), format = DEFAULT_LOG_FORMAT, prettyPrintOptions) {
  if (_lodash.default.isNil(format)) {
    format = DEFAULT_LOG_FORMAT;
  }

  let pinoConfig = _objectSpread(_objectSpread({
    customLevels: {
      http: 25
    }
  }, options), {}, {
    level: options.level,
    serializers: {
      err: _pino.default.stdSerializers.err,
      req: _pino.default.stdSerializers.req,
      res: _pino.default.stdSerializers.res
    }
  });

  debug('has prettifier? %o', !isProd()); // pretty logs are not allowed in production for performance reasons

  if ((format === DEFAULT_LOG_FORMAT || format !== 'json') && isProd() === false) {
    pinoConfig = Object.assign({}, pinoConfig, {
      // more info
      // https://github.com/pinojs/pino-pretty/issues/37
      prettyPrint: _objectSpread({
        levelFirst: true,
        prettyStamp: format === 'pretty-timestamped'
      }, prettyPrintOptions),
      prettifier: require('./formatter')
    });
  }

  const logger = (0, _pino.default)(pinoConfig, destination);

  if (process.env.DEBUG) {
    logger.on('level-change', (lvl, val, prevLvl, prevVal) => {
      debug('%s (%d) was changed to %s (%d)', lvl, val, prevLvl, prevVal);
    });
  }

  return logger;
}

function getLogger() {
  if (_lodash.default.isNil(logger)) {
    process.emitWarning('logger is not defined');
    return;
  }

  return logger;
}

const DEFAULT_LOGGER_CONF = {
  type: 'stdout',
  format: 'pretty',
  level: 'http',
  colors: true
};

function setup(options = [DEFAULT_LOGGER_CONF]) {
  var _loggerConfig, _loggerConfig2, _loggerConfig3;

  debug('setup logger');
  const isLegacyConf = Array.isArray(options);

  if (isLegacyConf) {
    const deprecateMessage = 'deprecate: multiple logger configuration is deprecated, please check the migration guide.';
    process.emitWarning(deprecateMessage);
  } // verdaccio 5 does not allow multiple logger configuration
  // backward compatible, pick only the first option
  // next major will thrown an error


  let loggerConfig = isLegacyConf ? options[0] : options;

  if (!((_loggerConfig = loggerConfig) !== null && _loggerConfig !== void 0 && _loggerConfig.level)) {
    loggerConfig = Object.assign({}, {
      level: 'http'
    }, loggerConfig);
  }

  const pinoConfig = {
    level: loggerConfig.level
  };
  let colors = typeof ((_loggerConfig2 = loggerConfig) === null || _loggerConfig2 === void 0 ? void 0 : _loggerConfig2.colors) === 'boolean' ? Boolean((_loggerConfig3 = loggerConfig) === null || _loggerConfig3 === void 0 ? void 0 : _loggerConfig3.colors) : process.stdout.isTTY;

  if ('EXPERIMENTAL_VERDACCIO_LOGGER_COLORS' in process.env) {
    colors = process.env.EXPERIMENTAL_VERDACCIO_LOGGER_COLORS != 'false';
  }

  const prettyPrintOptions = {
    // we hide warning since the prettifier should not be used in production
    // https://getpino.io/#/docs/pretty?id=prettifier-api
    suppressFlushSyncWarning: true,
    colors
  };

  if (loggerConfig.type === 'file') {
    debug('logging file enabled');

    const destination = _pino.default.destination(loggerConfig.path);

    process.on('SIGUSR2', () => destination.reopen());
    exports.logger = logger = createLogger(pinoConfig, destination, loggerConfig.format, prettyPrintOptions);
  } else if (loggerConfig.type === 'rotating-file') {
    process.emitWarning('rotating-file type is not longer supported, consider use [logrotate] instead');
    debug('logging stdout enabled');
    exports.logger = logger = createLogger(pinoConfig, _pino.default.destination(1), loggerConfig.format, prettyPrintOptions);
  } else {
    debug('logging stdout enabled');
    exports.logger = logger = createLogger(pinoConfig, _pino.default.destination(1), loggerConfig.format, prettyPrintOptions);
  }

  if (isProd()) {
    // why only on prod? https://github.com/pinojs/pino/issues/920#issuecomment-710807667
    const finalHandler = _pino.default.final(logger, (err, finalLogger, event) => {
      finalLogger.info(`${event} caught`);

      if (err) {
        finalLogger.error(err, 'error caused exit');
      }

      process.exit(err ? 1 : 0);
    });

    process.on('uncaughtException', err => finalHandler(err, 'uncaughtException'));
    process.on('unhandledRejection', err => finalHandler(err, 'unhandledRejection'));
    process.on('beforeExit', () => finalHandler(null, 'beforeExit'));
    process.on('exit', () => finalHandler(null, 'exit'));
    process.on('uncaughtException', err => finalHandler(err, 'uncaughtException'));
    process.on('SIGINT', () => finalHandler(null, 'SIGINT'));
    process.on('SIGQUIT', () => finalHandler(null, 'SIGQUIT'));
    process.on('SIGTERM', () => finalHandler(null, 'SIGTERM'));
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc1Byb2QiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJsb2dnZXIiLCJkZWJ1ZyIsIkRFRkFVTFRfTE9HX0ZPUk1BVCIsImNyZWF0ZUxvZ2dlciIsIm9wdGlvbnMiLCJsZXZlbCIsImRlc3RpbmF0aW9uIiwicGlubyIsImZvcm1hdCIsInByZXR0eVByaW50T3B0aW9ucyIsIl8iLCJpc05pbCIsInBpbm9Db25maWciLCJjdXN0b21MZXZlbHMiLCJodHRwIiwic2VyaWFsaXplcnMiLCJlcnIiLCJzdGRTZXJpYWxpemVycyIsInJlcSIsInJlcyIsIk9iamVjdCIsImFzc2lnbiIsInByZXR0eVByaW50IiwibGV2ZWxGaXJzdCIsInByZXR0eVN0YW1wIiwicHJldHRpZmllciIsInJlcXVpcmUiLCJERUJVRyIsIm9uIiwibHZsIiwidmFsIiwicHJldkx2bCIsInByZXZWYWwiLCJnZXRMb2dnZXIiLCJlbWl0V2FybmluZyIsIkRFRkFVTFRfTE9HR0VSX0NPTkYiLCJ0eXBlIiwiY29sb3JzIiwic2V0dXAiLCJpc0xlZ2FjeUNvbmYiLCJBcnJheSIsImlzQXJyYXkiLCJkZXByZWNhdGVNZXNzYWdlIiwibG9nZ2VyQ29uZmlnIiwiQm9vbGVhbiIsInN0ZG91dCIsImlzVFRZIiwiRVhQRVJJTUVOVEFMX1ZFUkRBQ0NJT19MT0dHRVJfQ09MT1JTIiwic3VwcHJlc3NGbHVzaFN5bmNXYXJuaW5nIiwicGF0aCIsInJlb3BlbiIsImZpbmFsSGFuZGxlciIsImZpbmFsIiwiZmluYWxMb2dnZXIiLCJldmVudCIsImluZm8iLCJlcnJvciIsImV4aXQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2xvZ2dlci9sb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJ1aWxkRGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IHsgeWVsbG93IH0gZnJvbSAna2xldXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBwaW5vIGZyb20gJ3Bpbm8nO1xuXG5mdW5jdGlvbiBpc1Byb2QoKSB7XG4gIHJldHVybiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nO1xufVxuXG5leHBvcnQgbGV0IGxvZ2dlcjtcbmNvbnN0IGRlYnVnID0gYnVpbGREZWJ1ZygndmVyZGFjY2lvOmxvZ2dlcicpO1xuY29uc3QgREVGQVVMVF9MT0dfRk9STUFUID0gaXNQcm9kKCkgPyAnanNvbicgOiAncHJldHR5JztcblxuZXhwb3J0IHR5cGUgTG9nUGx1Z2luID0ge1xuICBkZXN0OiBzdHJpbmc7XG4gIG9wdGlvbnM/OiBhbnlbXTtcbn07XG5cbmV4cG9ydCB0eXBlIExvZ1R5cGUgPSAnZmlsZScgfCAnc3Rkb3V0JztcbmV4cG9ydCB0eXBlIExvZ0Zvcm1hdCA9ICdqc29uJyB8ICdwcmV0dHktdGltZXN0YW1wZWQnIHwgJ3ByZXR0eSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVMb2dnZXIob3B0aW9ucyA9IHsgbGV2ZWw6ICdodHRwJyB9LCBkZXN0aW5hdGlvbiA9IHBpbm8uZGVzdGluYXRpb24oMSksIGZvcm1hdDogTG9nRm9ybWF0ID0gREVGQVVMVF9MT0dfRk9STUFULCBwcmV0dHlQcmludE9wdGlvbnMpIHtcbiAgaWYgKF8uaXNOaWwoZm9ybWF0KSkge1xuICAgIGZvcm1hdCA9IERFRkFVTFRfTE9HX0ZPUk1BVDtcbiAgfVxuXG4gIGxldCBwaW5vQ29uZmlnID0ge1xuICAgIGN1c3RvbUxldmVsczoge1xuICAgICAgaHR0cDogMjUsXG4gICAgfSxcbiAgICAuLi5vcHRpb25zLFxuICAgIGxldmVsOiBvcHRpb25zLmxldmVsLFxuICAgIHNlcmlhbGl6ZXJzOiB7XG4gICAgICBlcnI6IHBpbm8uc3RkU2VyaWFsaXplcnMuZXJyLFxuICAgICAgcmVxOiBwaW5vLnN0ZFNlcmlhbGl6ZXJzLnJlcSxcbiAgICAgIHJlczogcGluby5zdGRTZXJpYWxpemVycy5yZXMsXG4gICAgfSxcbiAgfTtcblxuICBkZWJ1ZygnaGFzIHByZXR0aWZpZXI/ICVvJywgIWlzUHJvZCgpKTtcbiAgLy8gcHJldHR5IGxvZ3MgYXJlIG5vdCBhbGxvd2VkIGluIHByb2R1Y3Rpb24gZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnNcbiAgaWYgKChmb3JtYXQgPT09IERFRkFVTFRfTE9HX0ZPUk1BVCB8fCBmb3JtYXQgIT09ICdqc29uJykgJiYgaXNQcm9kKCkgPT09IGZhbHNlKSB7XG4gICAgcGlub0NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIHBpbm9Db25maWcsIHtcbiAgICAgIC8vIG1vcmUgaW5mb1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bpbm9qcy9waW5vLXByZXR0eS9pc3N1ZXMvMzdcbiAgICAgIHByZXR0eVByaW50OiB7XG4gICAgICAgIGxldmVsRmlyc3Q6IHRydWUsXG4gICAgICAgIHByZXR0eVN0YW1wOiBmb3JtYXQgPT09ICdwcmV0dHktdGltZXN0YW1wZWQnLFxuICAgICAgICAuLi5wcmV0dHlQcmludE9wdGlvbnMsXG4gICAgICB9LFxuICAgICAgcHJldHRpZmllcjogcmVxdWlyZSgnLi9mb3JtYXR0ZXInKSxcbiAgICB9KTtcbiAgfVxuICBjb25zdCBsb2dnZXIgPSBwaW5vKHBpbm9Db25maWcsIGRlc3RpbmF0aW9uKTtcblxuICBpZiAocHJvY2Vzcy5lbnYuREVCVUcpIHtcbiAgICBsb2dnZXIub24oJ2xldmVsLWNoYW5nZScsIChsdmwsIHZhbCwgcHJldkx2bCwgcHJldlZhbCkgPT4ge1xuICAgICAgZGVidWcoJyVzICglZCkgd2FzIGNoYW5nZWQgdG8gJXMgKCVkKScsIGx2bCwgdmFsLCBwcmV2THZsLCBwcmV2VmFsKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBsb2dnZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMb2dnZXIoKSB7XG4gIGlmIChfLmlzTmlsKGxvZ2dlcikpIHtcbiAgICBwcm9jZXNzLmVtaXRXYXJuaW5nKCdsb2dnZXIgaXMgbm90IGRlZmluZWQnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICByZXR1cm4gbG9nZ2VyO1xufVxuXG5jb25zdCBERUZBVUxUX0xPR0dFUl9DT05GOiBMb2dnZXJDb25maWdJdGVtID0ge1xuICB0eXBlOiAnc3Rkb3V0JyxcbiAgZm9ybWF0OiAncHJldHR5JyxcbiAgbGV2ZWw6ICdodHRwJyxcbiAgY29sb3JzOiB0cnVlLFxufTtcblxuZXhwb3J0IHR5cGUgTG9nZ2VyQ29uZmlnSXRlbSA9IHtcbiAgdHlwZT86IExvZ1R5cGU7XG4gIHBsdWdpbj86IExvZ1BsdWdpbjtcbiAgZm9ybWF0PzogTG9nRm9ybWF0O1xuICBwYXRoPzogc3RyaW5nO1xuICBsZXZlbD86IHN0cmluZztcbiAgY29sb3JzPzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIExvZ2dlckNvbmZpZyA9IExvZ2dlckNvbmZpZ0l0ZW1bXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNldHVwKG9wdGlvbnM6IExvZ2dlckNvbmZpZyB8IExvZ2dlckNvbmZpZ0l0ZW0gPSBbREVGQVVMVF9MT0dHRVJfQ09ORl0pIHtcbiAgZGVidWcoJ3NldHVwIGxvZ2dlcicpO1xuICBjb25zdCBpc0xlZ2FjeUNvbmYgPSBBcnJheS5pc0FycmF5KG9wdGlvbnMpO1xuICBpZiAoaXNMZWdhY3lDb25mKSB7XG4gICAgY29uc3QgZGVwcmVjYXRlTWVzc2FnZSA9ICdkZXByZWNhdGU6IG11bHRpcGxlIGxvZ2dlciBjb25maWd1cmF0aW9uIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSBjaGVjayB0aGUgbWlncmF0aW9uIGd1aWRlLic7XG4gICAgcHJvY2Vzcy5lbWl0V2FybmluZyhkZXByZWNhdGVNZXNzYWdlKTtcbiAgfVxuXG4gIC8vIHZlcmRhY2NpbyA1IGRvZXMgbm90IGFsbG93IG11bHRpcGxlIGxvZ2dlciBjb25maWd1cmF0aW9uXG4gIC8vIGJhY2t3YXJkIGNvbXBhdGlibGUsIHBpY2sgb25seSB0aGUgZmlyc3Qgb3B0aW9uXG4gIC8vIG5leHQgbWFqb3Igd2lsbCB0aHJvd24gYW4gZXJyb3JcbiAgbGV0IGxvZ2dlckNvbmZpZyA9IGlzTGVnYWN5Q29uZiA/IG9wdGlvbnNbMF0gOiBvcHRpb25zO1xuICBpZiAoIWxvZ2dlckNvbmZpZz8ubGV2ZWwpIHtcbiAgICBsb2dnZXJDb25maWcgPSBPYmplY3QuYXNzaWduKFxuICAgICAge30sXG4gICAgICB7XG4gICAgICAgIGxldmVsOiAnaHR0cCcsXG4gICAgICB9LFxuICAgICAgbG9nZ2VyQ29uZmlnXG4gICAgKTtcbiAgfVxuICBjb25zdCBwaW5vQ29uZmlnID0geyBsZXZlbDogbG9nZ2VyQ29uZmlnLmxldmVsIH07XG4gIGxldCBjb2xvcnMgPSB0eXBlb2YgbG9nZ2VyQ29uZmlnPy5jb2xvcnMgPT09ICdib29sZWFuJyA/IEJvb2xlYW4obG9nZ2VyQ29uZmlnPy5jb2xvcnMpIDogcHJvY2Vzcy5zdGRvdXQuaXNUVFk7XG4gIGlmICgnRVhQRVJJTUVOVEFMX1ZFUkRBQ0NJT19MT0dHRVJfQ09MT1JTJyBpbiBwcm9jZXNzLmVudikge1xuICAgIGNvbG9ycyA9IHByb2Nlc3MuZW52LkVYUEVSSU1FTlRBTF9WRVJEQUNDSU9fTE9HR0VSX0NPTE9SUyAhPSAnZmFsc2UnO1xuICB9XG4gIGNvbnN0IHByZXR0eVByaW50T3B0aW9ucyA9IHtcbiAgICAvLyB3ZSBoaWRlIHdhcm5pbmcgc2luY2UgdGhlIHByZXR0aWZpZXIgc2hvdWxkIG5vdCBiZSB1c2VkIGluIHByb2R1Y3Rpb25cbiAgICAvLyBodHRwczovL2dldHBpbm8uaW8vIy9kb2NzL3ByZXR0eT9pZD1wcmV0dGlmaWVyLWFwaVxuICAgIHN1cHByZXNzRmx1c2hTeW5jV2FybmluZzogdHJ1ZSxcbiAgICBjb2xvcnMsXG4gIH07XG4gIGlmIChsb2dnZXJDb25maWcudHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgZGVidWcoJ2xvZ2dpbmcgZmlsZSBlbmFibGVkJyk7XG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBwaW5vLmRlc3RpbmF0aW9uKGxvZ2dlckNvbmZpZy5wYXRoKTtcbiAgICBwcm9jZXNzLm9uKCdTSUdVU1IyJywgKCkgPT4gZGVzdGluYXRpb24ucmVvcGVuKCkpO1xuICAgIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcihwaW5vQ29uZmlnLCBkZXN0aW5hdGlvbiwgbG9nZ2VyQ29uZmlnLmZvcm1hdCwgcHJldHR5UHJpbnRPcHRpb25zKTtcbiAgfSBlbHNlIGlmIChsb2dnZXJDb25maWcudHlwZSA9PT0gJ3JvdGF0aW5nLWZpbGUnKSB7XG4gICAgcHJvY2Vzcy5lbWl0V2FybmluZygncm90YXRpbmctZmlsZSB0eXBlIGlzIG5vdCBsb25nZXIgc3VwcG9ydGVkLCBjb25zaWRlciB1c2UgW2xvZ3JvdGF0ZV0gaW5zdGVhZCcpO1xuICAgIGRlYnVnKCdsb2dnaW5nIHN0ZG91dCBlbmFibGVkJyk7XG4gICAgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKHBpbm9Db25maWcsIHBpbm8uZGVzdGluYXRpb24oMSksIGxvZ2dlckNvbmZpZy5mb3JtYXQsIHByZXR0eVByaW50T3B0aW9ucyk7XG4gIH0gZWxzZSB7XG4gICAgZGVidWcoJ2xvZ2dpbmcgc3Rkb3V0IGVuYWJsZWQnKTtcbiAgICBsb2dnZXIgPSBjcmVhdGVMb2dnZXIocGlub0NvbmZpZywgcGluby5kZXN0aW5hdGlvbigxKSwgbG9nZ2VyQ29uZmlnLmZvcm1hdCwgcHJldHR5UHJpbnRPcHRpb25zKTtcbiAgfVxuXG4gIGlmIChpc1Byb2QoKSkge1xuICAgIC8vIHdoeSBvbmx5IG9uIHByb2Q/IGh0dHBzOi8vZ2l0aHViLmNvbS9waW5vanMvcGluby9pc3N1ZXMvOTIwI2lzc3VlY29tbWVudC03MTA4MDc2NjdcbiAgICBjb25zdCBmaW5hbEhhbmRsZXIgPSBwaW5vLmZpbmFsKGxvZ2dlciwgKGVyciwgZmluYWxMb2dnZXIsIGV2ZW50KSA9PiB7XG4gICAgICBmaW5hbExvZ2dlci5pbmZvKGAke2V2ZW50fSBjYXVnaHRgKTtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgZmluYWxMb2dnZXIuZXJyb3IoZXJyLCAnZXJyb3IgY2F1c2VkIGV4aXQnKTtcbiAgICAgIH1cbiAgICAgIHByb2Nlc3MuZXhpdChlcnIgPyAxIDogMCk7XG4gICAgfSk7XG5cbiAgICBwcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnIpID0+IGZpbmFsSGFuZGxlcihlcnIsICd1bmNhdWdodEV4Y2VwdGlvbicpKTtcbiAgICBwcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAoZXJyKSA9PiBmaW5hbEhhbmRsZXIoZXJyIGFzIEVycm9yLCAndW5oYW5kbGVkUmVqZWN0aW9uJykpO1xuICAgIHByb2Nlc3Mub24oJ2JlZm9yZUV4aXQnLCAoKSA9PiBmaW5hbEhhbmRsZXIobnVsbCwgJ2JlZm9yZUV4aXQnKSk7XG4gICAgcHJvY2Vzcy5vbignZXhpdCcsICgpID0+IGZpbmFsSGFuZGxlcihudWxsLCAnZXhpdCcpKTtcbiAgICBwcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnIpID0+IGZpbmFsSGFuZGxlcihlcnIsICd1bmNhdWdodEV4Y2VwdGlvbicpKTtcbiAgICBwcm9jZXNzLm9uKCdTSUdJTlQnLCAoKSA9PiBmaW5hbEhhbmRsZXIobnVsbCwgJ1NJR0lOVCcpKTtcbiAgICBwcm9jZXNzLm9uKCdTSUdRVUlUJywgKCkgPT4gZmluYWxIYW5kbGVyKG51bGwsICdTSUdRVUlUJykpO1xuICAgIHByb2Nlc3Mub24oJ1NJR1RFUk0nLCAoKSA9PiBmaW5hbEhhbmRsZXIobnVsbCwgJ1NJR1RFUk0nKSk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOzs7Ozs7Ozs7O0FBRUEsU0FBU0EsTUFBVCxHQUFrQjtFQUNoQixPQUFPQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUFoQztBQUNEOztBQUVNLElBQUlDLE1BQUo7O0FBQ1AsTUFBTUMsS0FBSyxHQUFHLG9CQUFXLGtCQUFYLENBQWQ7QUFDQSxNQUFNQyxrQkFBa0IsR0FBR04sTUFBTSxLQUFLLE1BQUwsR0FBYyxRQUEvQzs7QUFVTyxTQUFTTyxZQUFULENBQXNCQyxPQUFPLEdBQUc7RUFBRUMs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