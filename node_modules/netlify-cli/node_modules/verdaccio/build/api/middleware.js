"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LOG_VERDACCIO_ERROR = exports.LOG_VERDACCIO_BYTES = exports.LOG_STATUS_MESSAGE = void 0;
exports.allow = allow;
exports.antiLoop = antiLoop;
exports.encodeScopePackage = encodeScopePackage;
exports.errorReportingMiddleware = errorReportingMiddleware;
exports.expectJson = expectJson;
exports.final = final;
exports.log = log;
exports.match = match;
exports.media = media;
exports.serveFavicon = serveFavicon;
exports.setSecurityWebHeaders = setSecurityWebHeaders;
exports.validateName = validateName;
exports.validatePackage = validatePackage;

var _debug = _interopRequireDefault(require("debug"));

var _fs = _interopRequireDefault(require("fs"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _validator = _interopRequireDefault(require("validator"));

var _constants = require("../lib/constants");

var _cryptoUtils = require("../lib/crypto-utils");

var _logger = require("../lib/logger");

var _utils = require("../lib/utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const debug = (0, _debug.default)('verdaccio');

function match(regexp) {
  return function (req, res, next, value) {
    if (regexp.exec(value)) {
      next();
    } else {
      next('route');
    }
  };
}

function serveFavicon(config) {
  return function (req, res, next) {
    try {
      var _config$web;

      // @ts-ignore
      const logoConf = config === null || config === void 0 ? void 0 : (_config$web = config.web) === null || _config$web === void 0 ? void 0 : _config$web.favicon;

      if (logoConf === '') {
        debug('favicon disabled');
        res.status(404);
      } else if (!_lodash.default.isEmpty(logoConf)) {
        debug('custom favicon');

        if (_validator.default.isURL(logoConf, {
          require_host: true,
          require_valid_protocol: true
        })) {
          debug('redirect to %o', logoConf);
          res.redirect(logoConf);
          return;
        } else {
          const faviconPath = _path.default.normalize(logoConf);

          debug('serving favicon from %o', faviconPath);

          _fs.default.access(faviconPath, _fs.default.constants.R_OK, err => {
            if (err) {
              debug('no read permissions to read: %o, reason:', logoConf, err === null || err === void 0 ? void 0 : err.message);
              return res.status(_constants.HTTP_STATUS.NOT_FOUND).end();
            } else {
              res.setHeader('content-type', 'image/x-icon');

              _fs.default.createReadStream(faviconPath).pipe(res);

              debug('rendered custom ico');
            }
          });
        }
      } else {
        res.setHeader('content-type', 'image/x-icon');

        _fs.default.createReadStream(_path.default.posix.join(__dirname, './web/html/favicon.ico')).pipe(res);

        debug('rendered ico');
      }
    } catch (err) {
      debug('error triggered, favicon not found');
      res.status(_constants.HTTP_STATUS.NOT_FOUND).end();
    }
  };
}

function setSecurityWebHeaders(req, res, next) {
  // disable loading in frames (clickjacking, etc.)
  res.header(_constants.HEADERS.FRAMES_OPTIONS, 'deny'); // avoid stablish connections outside of domain

  res.header(_constants.HEADERS.CSP, "connect-src 'self'"); // https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff

  res.header(_constants.HEADERS.CTO, 'nosniff'); // https://stackoverflow.com/questions/9090577/what-is-the-http-header-x-xss-protection

  res.header(_constants.HEADERS.XSS, '1; mode=block');
  next();
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validateName(req, res, next, value, name) {
  if (value === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validateName)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validatePackage(req, res, next, value, name) {
  if (value === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validatePackage)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
}

function media(expect) {
  return function (req, res, next) {
    if (req.headers[_constants.HEADER_TYPE.CONTENT_TYPE] !== expect) {
      next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.UNSUPPORTED_MEDIA, 'wrong content-type, expect: ' + expect + ', got: ' + req.get(_constants.HEADER_TYPE.CONTENT_TYPE)));
    } else {
      next();
    }
  };
}

function encodeScopePackage(req, res, next) {
  if (req.url.indexOf('@') !== -1) {
    // e.g.: /@org/pkg/1.2.3 -> /@org%2Fpkg/1.2.3, /@org%2Fpkg/1.2.3 -> /@org%2Fpkg/1.2.3
    req.url = req.url.replace(/^(\/@[^\/%]+)\/(?!$)/, '$1%2F');
  }

  next();
}

function expectJson(req, res, next) {
  if (!(0, _utils.isObject)(req.body)) {
    return next(_utils.ErrorCode.getBadRequest("can't parse incoming json"));
  }

  next();
}

function antiLoop(config) {
  return function (req, res, next) {
    var _req$headers;

    if ((req === null || req === void 0 ? void 0 : (_req$headers = req.headers) === null || _req$headers === void 0 ? void 0 : _req$headers.via) != null) {
      const arr = req.headers.via.split(',');

      for (let i = 0; i < arr.length; i++) {
        const m = arr[i].match(/\s*(\S+)\s+(\S+)/);

        if (m && m[2] === config.server_id) {
          return next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.LOOP_DETECTED, 'loop detected'));
        }
      }
    }

    next();
  };
}

function allow(auth) {
  return function (action) {
    return function (req, res, next) {
      req.pause();
      const packageName = req.params.scope ? `@${req.params.scope}/${req.params.package}` : req.params.package;
      let packageVersion = undefined;

      if (req.params.filename) {
        packageVersion = (0, _utils.getVersionFromTarball)(req.params.filename) || undefined;
      } else if (typeof req.body.versions === 'object') {
        packageVersion = Object.keys(req.body.versions)[0];
      }

      const remote = req.remote_user;
      debug('[middleware/allow][%o] allow for %o', action, remote === null || remote === void 0 ? void 0 : remote.name);
      auth['allow_' + action]({
        packageName,
        packageVersion
      }, remote, function (error, allowed) {
        req.resume();

        if (error) {
          next(error);
        } else if (allowed) {
          next();
        } else {
          // last plugin (that's our built-in one) returns either
          // cb(err) or cb(null, true), so this should never happen
          throw _utils.ErrorCode.getInternalError(_constants.API_ERROR.PLUGIN_ERROR);
        }
      });
    };
  };
}

function final(body, req, res, next) {
  if (res.statusCode === _constants.HTTP_STATUS.UNAUTHORIZED && !res.getHeader(_constants.HEADERS.WWW_AUTH)) {
    // they say it's required for 401, so...
    res.header(_constants.HEADERS.WWW_AUTH, `${_constants.TOKEN_BASIC}, ${_constants.TOKEN_BEARER}`);
  }

  try {
    if (_lodash.default.isString(body) || _lodash.default.isObject(body)) {
      if (!res.getHeader(_constants.HEADERS.CONTENT_TYPE)) {
        res.header(_constants.HEADERS.CONTENT_TYPE, _constants.HEADERS.JSON);
      }

      if (typeof body === 'object' && _lodash.default.isNil(body) === false) {
        if (typeof body.error === 'string') {
          res.locals._verdaccio_error = body.error;
        }

        body = JSON.stringify(body, undefined, '  ') + '\n';
      } // don't send etags with errors


      if (!res.statusCode || res.statusCode >= _constants.HTTP_STATUS.OK && res.statusCode < _constants.HTTP_STATUS.MULTIPLE_CHOICES) {
        res.header(_constants.HEADERS.ETAG, '"' + (0, _cryptoUtils.stringToMD5)(body) + '"');
      }
    } else {// send(null), send(204), etc.
    }
  } catch (err) {
    // if verdaccio sends headers first, and then calls res.send()
    // as an error handler, we can't report error properly,
    // and should just close socket
    if (err.message.match(/set headers after they are sent/)) {
      if (_lodash.default.isNil(res.socket) === false) {
        // @ts-ignore
        res.socket.destroy();
      }

      return;
    }

    throw err;
  }

  res.send(body);
}

const LOG_STATUS_MESSAGE = "@{status}, user: @{user}(@{remoteIP}), req: '@{request.method} @{request.url}'";
exports.LOG_STATUS_MESSAGE = LOG_STATUS_MESSAGE;
const LOG_VERDACCIO_ERROR = `${LOG_STATUS_MESSAGE}, error: @{!error}`;
exports.LOG_VERDACCIO_ERROR = LOG_VERDACCIO_ERROR;
const LOG_VERDACCIO_BYTES = `${LOG_STATUS_MESSAGE}, bytes: @{bytes.in}/@{bytes.out}`;
exports.LOG_VERDACCIO_BYTES = LOG_VERDACCIO_BYTES;

function log(config) {
  return function (req, res, next) {
    var _config$experiments;

    const _auth = req.headers.authorization;

    if (_lodash.default.isNil(_auth) === false) {
      req.headers.authorization = '<Classified>';
    }

    const _cookie = req.get('cookie');

    if (_lodash.default.isNil(_cookie) === false) {
      req.headers.cookie = '<Classified>';
    }

    req.url = req.originalUrl; // avoid log noise data from static content

    if (req.originalUrl.match(/static/) === null) {
      _logger.logger.http({
        req: req,
        ip: req.ip
      }, "@{ip} requested '@{req.method} @{req.url}'");
    }

    req.originalUrl = req.url;

    if (_lodash.default.isNil(_auth) === false) {
      req.headers.authorization = _auth;
    }

    if (_lodash.default.isNil(_cookie) === false) {
      req.headers.cookie = _cookie;
    }

    let bytesin = 0;

    if ((config === null || config === void 0 ? void 0 : (_config$experiments = config.experiments) === null || _config$experiments === void 0 ? void 0 : _config$experiments.bytesin_off) !== true) {
      req.on('data', function (chunk) {
        bytesin += chunk.length;
      });
    }

    let bytesout = 0;
    const _write = res.write; // FIXME: res.write should return boolean
    // @ts-ignore

    res.write = function (buf) {
      bytesout += buf.length;
      /* eslint prefer-rest-params: "off" */
      // @ts-ignore

      _write.apply(res, arguments);
    };

    let logHasBeenCalled = false;

    const log = function () {
      if (logHasBeenCalled) {
        return;
      }

      logHasBeenCalled = true;
      const forwardedFor = req.get('x-forwarded-for');
      const remoteAddress = req.connection.remoteAddress;
      const remoteIP = forwardedFor ? `${forwardedFor} via ${remoteAddress}` : remoteAddress;
      let message;

      if (res.locals._verdaccio_error) {
        message = LOG_VERDACCIO_ERROR;
      } else {
        message = LOG_VERDACCIO_BYTES;
      }

      req.url = req.originalUrl; // avoid log noise data from static content

      if (req.url.match(/static/) === null) {
        _logger.logger.http({
          request: {
            method: req.method,
            url: req.url
          },
          user: req.remote_user && req.remote_user.name || null,
          remoteIP,
          status: res.statusCode,
          error: res.locals._verdaccio_error,
          bytes: {
            in: bytesin,
            out: bytesout
          }
        }, message);

        req.originalUrl = req.url;
      }
    };

    req.on('close', function () {
      log();
    });
    const _end = res.end;

    res.end = function (buf) {
      if (buf) {
        bytesout += buf.length;
      }
      /* eslint prefer-rest-params: "off" */
      // @ts-ignore


      _end.apply(res, arguments);

      log();
    };

    next();
  };
} // Middleware


function errorReportingMiddleware(req, res, next) {
  res.locals.report_error = res.locals.report_error || function (err) {
    if (err.status && err.status >= _constants.HTTP_STATUS.BAD_REQUEST && err.status < 600) {
      if (!res.headersSent) {
        res.status(err.status);
        next({
          error: err.message || _constants.API_ERROR.UNKNOWN_ERROR
        });
      }
    } else {
      _logger.logger.error({
        err: err
      }, 'unexpected error: @{!err.message}\n@{err.stack}');

      if (!res.status || !res.send) {
        _logger.logger.error('this is an error in express.js, please report this');

        res.destroy();
      } else if (!res.headersSent) {
        res.status(_constants.HTTP_STATUS.INTERNAL_ERROR);
        next({
          error: _constants.API_ERROR.INTERNAL_SERVER_ERROR
        });
      } else {// socket should be already closed
      }
    }
  };

  next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWJ1ZyIsIm1hdGNoIiwicmVnZXhwIiwicmVxIiwicmVzIiwibmV4dCIsInZhbHVlIiwiZXhlYyIsInNlcnZlRmF2aWNvbiIsImNvbmZpZyIsImxvZ29Db25mIiwid2ViIiwiZmF2aWNvbiIsInN0YXR1cyIsIl8iLCJpc0VtcHR5IiwidmFsaWRhdG9yIiwiaXNVUkwiLCJyZXF1aXJlX2hvc3QiLCJyZXF1aXJlX3ZhbGlkX3Byb3RvY29sIiwicmVkaXJlY3QiLCJmYXZpY29uUGF0aCIsInBhdGgiLCJub3JtYWxpemUiLCJmcyIsImFjY2VzcyIsImNvbnN0YW50cyIsIlJfT0siLCJlcnIiLCJtZXNzYWdlIiwiSFRUUF9TVEFUVVMiLCJOT1RfRk9VTkQiLCJlbmQiLCJzZXRIZWFkZXIiLCJjcmVhdGVSZWFkU3RyZWFtIiwicGlwZSIsInBvc2l4Iiwiam9pbiIsIl9fZGlybmFtZSIsInNldFNlY3VyaXR5V2ViSGVhZGVycyIsImhlYWRlciIsIkhFQURFUlMiLCJGUkFNRVNfT1BUSU9OUyIsIkNTUCIsIkNUTyIsIlhTUyIsInZhbGlkYXRlTmFtZSIsIm5hbWUiLCJFcnJvckNvZGUiLCJnZXRGb3JiaWRkZW4iLCJ2YWxpZGF0ZVBhY2thZ2UiLCJtZWRpYSIsImV4cGVjdCIsImhlYWRlcnMiLCJIRUFERVJfVFlQRSIsIkNPTlRFTlRfVFlQRSIsImdldENvZGUiLCJVTlNVUFBPUlRFRF9NRURJQSIsImdldCIsImVuY29kZVNjb3BlUGFja2FnZSIsInVybCIsImluZGV4T2YiLCJyZXBsYWNlIiwiZXhwZWN0SnNvbiIsImJvZHkiLCJnZXRCYWRSZXF1ZXN0IiwiYW50aUxvb3AiLCJ2aWEiLCJhcnIiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJtIiwic2VydmVyX2lkIiwiTE9PUF9ERVRFQ1RFRCIsImFsbG93IiwiYXV0aCIsImFjdGlvbiIsInBhdXNlIiwicGFja2FnZU5hbWUiLCJwYXJhbXMiLCJzY29wZSIsInBhY2thZ2UiLCJwYWNrYWdlVmVyc2lvbiIsInVuZGVmaW5lZCIsImZpbGVuYW1lIiwidmVyc2lvbnMiLCJPYmplY3QiLCJrZXlzIiwicmVtb3RlIiwicmVtb3RlX3VzZXIiLCJlcnJvciIsImFsbG93ZWQiLCJyZXN1bWUiLCJnZXRJbnRlcm5hbEVycm9yIiwiQVBJX0VSUk9SIiwiUExVR0lOX0VSUk9SIiwiZmluYWwiLCJzdGF0dXNDb2RlIiwiVU5BVVRIT1JJWkVEIiwiZ2V0SGVhZGVyIiwiV1dXX0FVVEgiLCJUT0tFTl9CQVNJQyIsIlRPS0VOX0JFQVJFUiIsImlzU3RyaW5nIiwiaXNPYmplY3QiLCJKU09OIiwiaXNOaWwiLCJsb2NhbHMiLCJfdmVyZGFjY2lvX2Vycm9yIiwic3RyaW5naWZ5IiwiT0siLCJNVUxUSVBMRV9DSE9JQ0VTIiwiRVRBRyIsInNvY2tldCIsImRlc3Ryb3kiLCJzZW5kIiwiTE9HX1NUQVRVU19NRVNTQUdFIiwiTE9HX1ZFUkRBQ0NJT19FUlJPUiIsIkxPR19WRVJEQUNDSU9fQllURVMiLCJsb2ciLCJfYXV0aCIsImF1dGhvcml6YXRpb24iLCJfY29va2llIiwiY29va2llIiwib3JpZ2luYWxVcmwiLCJsb2dnZXIiLCJodHRwIiwiaXAiLCJieXRlc2luIiwiZXhwZXJpbWVudHMiLCJieXRlc2luX29mZiIsIm9uIiwiY2h1bmsiLCJieXRlc291dCIsIl93cml0ZSIsIndyaXRlIiwiYnVmIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJsb2dIYXNCZWVuQ2FsbGVkIiwiZm9yd2FyZGVkRm9yIiwicmVtb3RlQWRkcmVzcyIsImNvbm5lY3Rpb24iLCJyZW1vdGVJUCIsInJlcXVlc3QiLCJtZXRob2QiLCJ1c2VyIiwiYnl0ZXMiLCJpbiIsIm91dCIsIl9lbmQiLCJlcnJvclJlcG9ydGluZ01pZGRsZXdhcmUiLCJyZXBvcnRfZXJyb3IiLCJCQURfUkVRVUVTVCIsImhlYWRlcnNTZW50IiwiVU5LTk9XTl9FUlJPUiIsIklOVEVSTkFMX0VSUk9SIiwiSU5URVJOQUxfU0VSVkVSX0VSUk9SIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwaS9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBidWlsZERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgdmFsaWRhdG9yIGZyb20gJ3ZhbGlkYXRvcic7XG5cbmltcG9ydCB7IFZlcmRhY2Npb0Vycm9yIH0gZnJvbSAnQHZlcmRhY2Npby9jb21tb25zLWFwaSc7XG5pbXBvcnQgeyBDb25maWcsIFBhY2thZ2UsIFJlbW90ZVVzZXIgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcblxuaW1wb3J0IHsgJE5leHRGdW5jdGlvblZlciwgJFJlcXVlc3RFeHRlbmQsICRSZXNwb25zZUV4dGVuZCwgSUF1dGggfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBBUElfRVJST1IsIEhFQURFUlMsIEhFQURFUl9UWVBFLCBIVFRQX1NUQVRVUywgVE9LRU5fQkFTSUMsIFRPS0VOX0JFQVJFUiB9IGZyb20gJy4uL2xpYi9jb25zdGFudHMnO1xuaW1wb3J0IHsgc3RyaW5nVG9NRDUgfSBmcm9tICcuLi9saWIvY3J5cHRvLXV0aWxzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgRXJyb3JDb2RlLCBnZXRWZXJzaW9uRnJvbVRhcmJhbGwsIGlzT2JqZWN0LCB2YWxpZGF0ZU5hbWUgYXMgdXRpbFZhbGlkYXRlTmFtZSwgdmFsaWRhdGVQYWNrYWdlIGFzIHV0aWxWYWxpZGF0ZVBhY2thZ2UgfSBmcm9tICcuLi9saWIvdXRpbHMnO1xuXG5jb25zdCBkZWJ1ZyA9IGJ1aWxkRGVidWcoJ3ZlcmRhY2NpbycpO1xuXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2gocmVnZXhwOiBSZWdFeHApOiBhbnkge1xuICByZXR1cm4gZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHJlZ2V4cC5leGVjKHZhbHVlKSkge1xuICAgICAgbmV4dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0KCdyb3V0ZScpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlcnZlRmF2aWNvbihjb25maWc6IENvbmZpZykge1xuICByZXR1cm4gZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGNvbnN0IGxvZ29Db25mOiBzdHJpbmcgPSBjb25maWc/LndlYj8uZmF2aWNvbiBhcyBzdHJpbmc7XG4gICAgICBpZiAobG9nb0NvbmYgPT09ICcnKSB7XG4gICAgICAgIGRlYnVnKCdmYXZpY29uIGRpc2FibGVkJyk7XG4gICAgICAgIHJlcy5zdGF0dXMoNDA0KTtcbiAgICAgIH0gZWxzZSBpZiAoIV8uaXNFbXB0eShsb2dvQ29uZikpIHtcbiAgICAgICAgZGVidWcoJ2N1c3RvbSBmYXZpY29uJyk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB2YWxpZGF0b3IuaXNVUkwobG9nb0NvbmYsIHtcbiAgICAgICAgICAgIHJlcXVpcmVfaG9zdDogdHJ1ZSxcbiAgICAgICAgICAgIHJlcXVpcmVfdmFsaWRfcHJvdG9jb2w6IHRydWUsXG4gICAgICAgICAgfSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGVidWcoJ3JlZGlyZWN0IHRvICVvJywgbG9nb0NvbmYpO1xuICAgICAgICAgIHJlcy5yZWRpcmVjdChsb2dvQ29uZik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGZhdmljb25QYXRoID0gcGF0aC5ub3JtYWxpemUobG9nb0NvbmYpO1xuICAgICAgICAgIGRlYnVnKCdzZXJ2aW5nIGZhdmljb24gZnJvbSAlbycsIGZhdmljb25QYXRoKTtcbiAgICAgICAgICBmcy5hY2Nlc3MoZmF2aWNvblBhdGgsIGZzLmNvbnN0YW50cy5SX09LLCAoZXJyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIGRlYnVnKCdubyByZWFkIHBlcm1pc3Npb25zIHRvIHJlYWQ6ICVvLCByZWFzb246JywgbG9nb0NvbmYsIGVycj8ubWVzc2FnZSk7XG4gICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCkuZW5kKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdjb250ZW50LXR5cGUnLCAnaW1hZ2UveC1pY29uJyk7XG4gICAgICAgICAgICAgIGZzLmNyZWF0ZVJlYWRTdHJlYW0oZmF2aWNvblBhdGgpLnBpcGUocmVzKTtcbiAgICAgICAgICAgICAgZGVidWcoJ3JlbmRlcmVkIGN1c3RvbSBpY28nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnNldEhlYWRlcignY29udGVudC10eXBlJywgJ2ltYWdlL3gtaWNvbicpO1xuICAgICAgICBmcy5jcmVhdGVSZWFkU3RyZWFtKHBhdGgucG9zaXguam9pbihfX2Rpcm5hbWUsICcuL3dlYi9odG1sL2Zhdmljb24uaWNvJykpLnBpcGUocmVzKTtcbiAgICAgICAgZGVidWcoJ3JlbmRlcmVkIGljbycpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZGVidWcoJ2Vycm9yIHRyaWdnZXJlZCwgZmF2aWNvbiBub3QgZm91bmQnKTtcbiAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKS5lbmQoKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRTZWN1cml0eVdlYkhlYWRlcnMocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgLy8gZGlzYWJsZSBsb2FkaW5nIGluIGZyYW1lcyAoY2xpY2tqYWNraW5nLCBldGMuKVxuICByZXMuaGVhZGVyKEhFQURFUlMuRlJBTUVTX09QVElPTlMsICdkZW55Jyk7XG4gIC8vIGF2b2lkIHN0YWJsaXNoIGNvbm5lY3Rpb25zIG91dHNpZGUgb2YgZG9tYWluXG4gIHJlcy5oZWFkZXIoSEVBREVSUy5DU1AsIFwiY29ubmVjdC1zcmMgJ3NlbGYnXCIpO1xuICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xODMzNzYzMC93aGF0LWlzLXgtY29udGVudC10eXBlLW9wdGlvbnMtbm9zbmlmZlxuICByZXMuaGVhZGVyKEhFQURFUlMuQ1RPLCAnbm9zbmlmZicpO1xuICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85MDkwNTc3L3doYXQtaXMtdGhlLWh0dHAtaGVhZGVyLXgteHNzLXByb3RlY3Rpb25cbiAgcmVzLmhlYWRlcihIRUFERVJTLlhTUywgJzE7IG1vZGU9YmxvY2snKTtcbiAgbmV4dCgpO1xufVxuXG4vLyBmbG93OiBleHByZXNzIGRvZXMgbm90IG1hdGNoIHByb3Blcmx5XG4vLyBmbG93IGluZm8gaHR0cHM6Ly9naXRodWIuY29tL2Zsb3d0eXBlL2Zsb3ctdHlwZWQvaXNzdWVzP3V0Zjg9JUUyJTlDJTkzJnE9aXMlM0Fpc3N1ZStpcyUzQW9wZW4rZXhwcmVzc1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlTmFtZShyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlciwgdmFsdWU6IHN0cmluZywgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gIGlmICh2YWx1ZSA9PT0gJy0nKSB7XG4gICAgLy8gc3BlY2lhbCBjYXNlIGluIGNvdWNoZGIgdXN1YWxseVxuICAgIG5leHQoJ3JvdXRlJyk7XG4gIH0gZWxzZSBpZiAodXRpbFZhbGlkYXRlTmFtZSh2YWx1ZSkpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgbmV4dChFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKCdpbnZhbGlkICcgKyBuYW1lKSk7XG4gIH1cbn1cblxuLy8gZmxvdzogZXhwcmVzcyBkb2VzIG5vdCBtYXRjaCBwcm9wZXJseVxuLy8gZmxvdyBpbmZvIGh0dHBzOi8vZ2l0aHViLmNvbS9mbG93dHlwZS9mbG93LXR5cGVkL2lzc3Vlcz91dGY4PSVFMiU5QyU5MyZxPWlzJTNBaXNzdWUraXMlM0FvcGVuK2V4cHJlc3NcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhY2thZ2UocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIsIHZhbHVlOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICBpZiAodmFsdWUgPT09ICctJykge1xuICAgIC8vIHNwZWNpYWwgY2FzZSBpbiBjb3VjaGRiIHVzdWFsbHlcbiAgICBuZXh0KCdyb3V0ZScpO1xuICB9IGVsc2UgaWYgKHV0aWxWYWxpZGF0ZVBhY2thZ2UodmFsdWUpKSB7XG4gICAgbmV4dCgpO1xuICB9IGVsc2Uge1xuICAgIG5leHQoRXJyb3JDb2RlLmdldEZvcmJpZGRlbignaW52YWxpZCAnICsgbmFtZSkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZWRpYShleHBlY3Q6IHN0cmluZyB8IG51bGwpOiBhbnkge1xuICByZXR1cm4gZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgaWYgKHJlcS5oZWFkZXJzW0hFQURFUl9UWVBFLkNPTlRFTlRfVFlQRV0gIT09IGV4cGVjdCkge1xuICAgICAgbmV4dChFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5VTlNVUFBPUlRFRF9NRURJQSwgJ3dyb25nIGNvbnRlbnQtdHlwZSwgZXhwZWN0OiAnICsgZXhwZWN0ICsgJywgZ290OiAnICsgcmVxLmdldChIRUFERVJfVFlQRS5DT05URU5UX1RZUEUpKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHQoKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVTY29wZVBhY2thZ2UocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgaWYgKHJlcS51cmwuaW5kZXhPZignQCcpICE9PSAtMSkge1xuICAgIC8vIGUuZy46IC9Ab3JnL3BrZy8xLjIuMyAtPiAvQG9yZyUyRnBrZy8xLjIuMywgL0BvcmclMkZwa2cvMS4yLjMgLT4gL0BvcmclMkZwa2cvMS4yLjNcbiAgICByZXEudXJsID0gcmVxLnVybC5yZXBsYWNlKC9eKFxcL0BbXlxcLyVdKylcXC8oPyEkKS8sICckMSUyRicpO1xuICB9XG4gIG5leHQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdEpzb24ocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgaWYgKCFpc09iamVjdChyZXEuYm9keSkpIHtcbiAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0QmFkUmVxdWVzdChcImNhbid0IHBhcnNlIGluY29taW5nIGpzb25cIikpO1xuICB9XG4gIG5leHQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFudGlMb29wKGNvbmZpZzogQ29uZmlnKTogRnVuY3Rpb24ge1xuICByZXR1cm4gZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgaWYgKHJlcT8uaGVhZGVycz8udmlhICE9IG51bGwpIHtcbiAgICAgIGNvbnN0IGFyciA9IHJlcS5oZWFkZXJzLnZpYS5zcGxpdCgnLCcpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBtID0gYXJyW2ldLm1hdGNoKC9cXHMqKFxcUyspXFxzKyhcXFMrKS8pO1xuICAgICAgICBpZiAobSAmJiBtWzJdID09PSBjb25maWcuc2VydmVyX2lkKSB7XG4gICAgICAgICAgcmV0dXJuIG5leHQoRXJyb3JDb2RlLmdldENvZGUoSFRUUF9TVEFUVVMuTE9PUF9ERVRFQ1RFRCwgJ2xvb3AgZGV0ZWN0ZWQnKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgbmV4dCgpO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWxsb3coYXV0aDogSUF1dGgpOiBGdW5jdGlvbiB7XG4gIHJldHVybiBmdW5jdGlvbiAoYWN0aW9uOiBzdHJpbmcpOiBGdW5jdGlvbiB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgcmVxLnBhdXNlKCk7XG4gICAgICBjb25zdCBwYWNrYWdlTmFtZSA9IHJlcS5wYXJhbXMuc2NvcGUgPyBgQCR7cmVxLnBhcmFtcy5zY29wZX0vJHtyZXEucGFyYW1zLnBhY2thZ2V9YCA6IHJlcS5wYXJhbXMucGFja2FnZTtcbiAgICAgIGxldCBwYWNrYWdlVmVyc2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKHJlcS5wYXJhbXMuZmlsZW5hbWUpIHtcbiAgICAgICAgcGFja2FnZVZlcnNpb24gPSBnZXRWZXJzaW9uRnJvbVRhcmJhbGwocmVxLnBhcmFtcy5maWxlbmFtZSkgfHwgdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVxLmJvZHkudmVyc2lvbnMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHBhY2thZ2VWZXJzaW9uID0gT2JqZWN0LmtleXMocmVxLmJvZHkudmVyc2lvbnMpWzBdO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVtb3RlOiBSZW1vdGVVc2VyID0gcmVxLnJlbW90ZV91c2VyO1xuICAgICAgZGVidWcoJ1ttaWRkbGV3YXJlL2FsbG93XVslb10gYWxsb3cgZm9yICVvJywgYWN0aW9uLCByZW1vdGU/Lm5hbWUpO1xuICAgICAgYXV0aFsnYWxsb3dfJyArIGFjdGlvbl0oeyBwYWNrYWdlTmFtZSwgcGFja2FnZVZlcnNpb24gfSwgcmVtb3RlLCBmdW5jdGlvbiAoZXJyb3IsIGFsbG93ZWQpOiB2b2lkIHtcbiAgICAgICAgcmVxLnJlc3VtZSgpO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBuZXh0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGxhc3QgcGx1Z2luICh0aGF0J3Mgb3VyIGJ1aWx0LWluIG9uZSkgcmV0dXJucyBlaXRoZXJcbiAgICAgICAgICAvLyBjYihlcnIpIG9yIGNiKG51bGwsIHRydWUpLCBzbyB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW5cbiAgICAgICAgICB0aHJvdyBFcnJvckNvZGUuZ2V0SW50ZXJuYWxFcnJvcihBUElfRVJST1IuUExVR0lOX0VSUk9SKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNaWRkbGV3YXJlRXJyb3Ige1xuICBlcnJvcjogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBGaW5hbEJvZHkgPSBQYWNrYWdlIHwgTWlkZGxld2FyZUVycm9yIHwgc3RyaW5nO1xuXG5leHBvcnQgZnVuY3Rpb24gZmluYWwoYm9keTogRmluYWxCb2R5LCByZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IEhUVFBfU1RBVFVTLlVOQVVUSE9SSVpFRCAmJiAhcmVzLmdldEhlYWRlcihIRUFERVJTLldXV19BVVRIKSkge1xuICAgIC8vIHRoZXkgc2F5IGl0J3MgcmVxdWlyZWQgZm9yIDQwMSwgc28uLi5cbiAgICByZXMuaGVhZGVyKEhFQURFUlMuV1dXX0FVVEgsIGAke1RPS0VOX0JBU0lDfSwgJHtUT0tFTl9CRUFSRVJ9YCk7XG4gIH1cblxuICB0cnkge1xuICAgIGlmIChfLmlzU3RyaW5nKGJvZHkpIHx8IF8uaXNPYmplY3QoYm9keSkpIHtcbiAgICAgIGlmICghcmVzLmdldEhlYWRlcihIRUFERVJTLkNPTlRFTlRfVFlQRSkpIHtcbiAgICAgICAgcmVzLmhlYWRlcihIRUFERVJTLkNPTlRFTlRfVFlQRSwgSEVBREVSUy5KU09OKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBib2R5ID09PSAnb2JqZWN0JyAmJiBfLmlzTmlsKGJvZHkpID09PSBmYWxzZSkge1xuICAgICAgICBpZiAodHlwZW9mIChib2R5IGFzIE1pZGRsZXdhcmVFcnJvcikuZXJyb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmVzLmxvY2Fscy5fdmVyZGFjY2lvX2Vycm9yID0gKGJvZHkgYXMgTWlkZGxld2FyZUVycm9yKS5lcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkoYm9keSwgdW5kZWZpbmVkLCAnICAnKSArICdcXG4nO1xuICAgICAgfVxuXG4gICAgICAvLyBkb24ndCBzZW5kIGV0YWdzIHdpdGggZXJyb3JzXG4gICAgICBpZiAoIXJlcy5zdGF0dXNDb2RlIHx8IChyZXMuc3RhdHVzQ29kZSA+PSBIVFRQX1NUQVRVUy5PSyAmJiByZXMuc3RhdHVzQ29kZSA8IEhUVFBfU1RBVFVTLk1VTFRJUExFX0NIT0lDRVMpKSB7XG4gICAgICAgIHJlcy5oZWFkZXIoSEVBREVSUy5FVEFHLCAnXCInICsgc3RyaW5nVG9NRDUoYm9keSBhcyBzdHJpbmcpICsgJ1wiJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHNlbmQobnVsbCksIHNlbmQoMjA0KSwgZXRjLlxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gaWYgdmVyZGFjY2lvIHNlbmRzIGhlYWRlcnMgZmlyc3QsIGFuZCB0aGVuIGNhbGxzIHJlcy5zZW5kKClcbiAgICAvLyBhcyBhbiBlcnJvciBoYW5kbGVyLCB3ZSBjYW4ndCByZXBvcnQgZXJyb3IgcHJvcGVybHksXG4gICAgLy8gYW5kIHNob3VsZCBqdXN0IGNsb3NlIHNvY2tldFxuICAgIGlmIChlcnIubWVzc2FnZS5tYXRjaCgvc2V0IGhlYWRlcnMgYWZ0ZXIgdGhleSBhcmUgc2VudC8pKSB7XG4gICAgICBpZiAoXy5pc05pbChyZXMuc29ja2V0KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICByZXMuc29ja2V0LmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgZXJyO1xuICB9XG5cbiAgcmVzLnNlbmQoYm9keSk7XG59XG5cbmV4cG9ydCBjb25zdCBMT0dfU1RBVFVTX01FU1NBR0UgPSBcIkB7c3RhdHVzfSwgdXNlcjogQHt1c2VyfShAe3JlbW90ZUlQfSksIHJlcTogJ0B7cmVxdWVzdC5tZXRob2R9IEB7cmVxdWVzdC51cmx9J1wiO1xuZXhwb3J0IGNvbnN0IExPR19WRVJEQUNDSU9fRVJST1IgPSBgJHtMT0dfU1RBVFVTX01FU1NBR0V9LCBlcnJvcjogQHshZXJyb3J9YDtcbmV4cG9ydCBjb25zdCBMT0dfVkVSREFDQ0lPX0JZVEVTID0gYCR7TE9HX1NUQVRVU19NRVNTQUdFfSwgYnl0ZXM6IEB7Ynl0ZXMuaW59L0B7Ynl0ZXMub3V0fWA7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2coY29uZmlnOiBDb25maWcpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgIGNvbnN0IF9hdXRoID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbjtcbiAgICBpZiAoXy5pc05pbChfYXV0aCkgPT09IGZhbHNlKSB7XG4gICAgICByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uID0gJzxDbGFzc2lmaWVkPic7XG4gICAgfVxuXG4gICAgY29uc3QgX2Nvb2tpZSA9IHJlcS5nZXQoJ2Nvb2tpZScpO1xuICAgIGlmIChfLmlzTmlsKF9jb29raWUpID09PSBmYWxzZSkge1xuICAgICAgcmVxLmhlYWRlcnMuY29va2llID0gJzxDbGFzc2lmaWVkPic7XG4gICAgfVxuXG4gICAgcmVxLnVybCA9IHJlcS5vcmlnaW5hbFVybDtcbiAgICAvLyBhdm9pZCBsb2cgbm9pc2UgZGF0YSBmcm9tIHN0YXRpYyBjb250ZW50XG4gICAgaWYgKHJlcS5vcmlnaW5hbFVybC5tYXRjaCgvc3RhdGljLykgPT09IG51bGwpIHtcbiAgICAgIGxvZ2dlci5odHRwKHsgcmVxOiByZXEsIGlwOiByZXEuaXAgfSwgXCJAe2lwfSByZXF1ZXN0ZWQgJ0B7cmVxLm1ldGhvZH0gQHtyZXEudXJsfSdcIik7XG4gICAgfVxuICAgIHJlcS5vcmlnaW5hbFVybCA9IHJlcS51cmw7XG5cbiAgICBpZiAoXy5pc05pbChfYXV0aCkgPT09IGZhbHNlKSB7XG4gICAgICByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uID0gX2F1dGg7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNOaWwoX2Nvb2tpZSkgPT09IGZhbHNlKSB7XG4gICAgICByZXEuaGVhZGVycy5jb29raWUgPSBfY29va2llO1xuICAgIH1cblxuICAgIGxldCBieXRlc2luID0gMDtcbiAgICBpZiAoY29uZmlnPy5leHBlcmltZW50cz8uYnl0ZXNpbl9vZmYgIT09IHRydWUpIHtcbiAgICAgIHJlcS5vbignZGF0YScsIGZ1bmN0aW9uIChjaHVuayk6IHZvaWQge1xuICAgICAgICBieXRlc2luICs9IGNodW5rLmxlbmd0aDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGxldCBieXRlc291dCA9IDA7XG4gICAgY29uc3QgX3dyaXRlID0gcmVzLndyaXRlO1xuICAgIC8vIEZJWE1FOiByZXMud3JpdGUgc2hvdWxkIHJldHVybiBib29sZWFuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJlcy53cml0ZSA9IGZ1bmN0aW9uIChidWYpOiBib29sZWFuIHtcbiAgICAgIGJ5dGVzb3V0ICs9IGJ1Zi5sZW5ndGg7XG4gICAgICAvKiBlc2xpbnQgcHJlZmVyLXJlc3QtcGFyYW1zOiBcIm9mZlwiICovXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBfd3JpdGUuYXBwbHkocmVzLCBhcmd1bWVudHMpO1xuICAgIH07XG5cbiAgICBsZXQgbG9nSGFzQmVlbkNhbGxlZCA9IGZhbHNlO1xuICAgIGNvbnN0IGxvZyA9IGZ1bmN0aW9uICgpOiB2b2lkIHtcbiAgICAgIGlmIChsb2dIYXNCZWVuQ2FsbGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxvZ0hhc0JlZW5DYWxsZWQgPSB0cnVlO1xuXG4gICAgICBjb25zdCBmb3J3YXJkZWRGb3IgPSByZXEuZ2V0KCd4LWZvcndhcmRlZC1mb3InKTtcbiAgICAgIGNvbnN0IHJlbW90ZUFkZHJlc3MgPSByZXEuY29ubmVjdGlvbi5yZW1vdGVBZGRyZXNzO1xuICAgICAgY29uc3QgcmVtb3RlSVAgPSBmb3J3YXJkZWRGb3IgPyBgJHtmb3J3YXJkZWRGb3J9IHZpYSAke3JlbW90ZUFkZHJlc3N9YCA6IHJlbW90ZUFkZHJlc3M7XG4gICAgICBsZXQgbWVzc2FnZTtcbiAgICAgIGlmIChyZXMubG9jYWxzLl92ZXJkYWNjaW9fZXJyb3IpIHtcbiAgICAgICAgbWVzc2FnZSA9IExPR19WRVJEQUNDSU9fRVJST1I7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlID0gTE9HX1ZFUkRBQ0NJT19CWVRFUztcbiAgICAgIH1cblxuICAgICAgcmVxLnVybCA9IHJlcS5vcmlnaW5hbFVybDtcbiAgICAgIC8vIGF2b2lkIGxvZyBub2lzZSBkYXRhIGZyb20gc3RhdGljIGNvbnRlbnRcbiAgICAgIGlmIChyZXEudXJsLm1hdGNoKC9zdGF0aWMvKSA9PT0gbnVsbCkge1xuICAgICAgICBsb2dnZXIuaHR0cChcbiAgICAgICAgICB7XG4gICAgICAgICAgICByZXF1ZXN0OiB7XG4gICAgICAgICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgICAgICAgICAgdXJsOiByZXEudXJsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVzZXI6IChyZXEucmVtb3RlX3VzZXIgJiYgcmVxLnJlbW90ZV91c2VyLm5hbWUpIHx8IG51bGwsXG4gICAgICAgICAgICByZW1vdGVJUCxcbiAgICAgICAgICAgIHN0YXR1czogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICBlcnJvcjogcmVzLmxvY2Fscy5fdmVyZGFjY2lvX2Vycm9yLFxuICAgICAgICAgICAgYnl0ZXM6IHtcbiAgICAgICAgICAgICAgaW46IGJ5dGVzaW4sXG4gICAgICAgICAgICAgIG91dDogYnl0ZXNvdXQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVzc2FnZVxuICAgICAgICApO1xuICAgICAgICByZXEub3JpZ2luYWxVcmwgPSByZXEudXJsO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXEub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCk6IHZvaWQge1xuICAgICAgbG9nKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBfZW5kID0gcmVzLmVuZDtcbiAgICByZXMuZW5kID0gZnVuY3Rpb24gKGJ1Zik6IHZvaWQge1xuICAgICAgaWYgKGJ1Zikge1xuICAgICAgICBieXRlc291dCArPSBidWYubGVuZ3RoO1xuICAgICAgfVxuICAgICAgLyogZXNsaW50IHByZWZlci1yZXN0LXBhcmFtczogXCJvZmZcIiAqL1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgX2VuZC5hcHBseShyZXMsIGFyZ3VtZW50cyk7XG4gICAgICBsb2coKTtcbiAgICB9O1xuICAgIG5leHQoKTtcbiAgfTtcbn1cblxuLy8gTWlkZGxld2FyZVxuZXhwb3J0IGZ1bmN0aW9uIGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZShyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICByZXMubG9jYWxzLnJlcG9ydF9lcnJvciA9XG4gICAgcmVzLmxvY2Fscy5yZXBvcnRfZXJyb3IgfHxcbiAgICBmdW5jdGlvbiAoZXJyOiBWZXJkYWNjaW9FcnJvcik6IHZvaWQge1xuICAgICAgaWYgKGVyci5zdGF0dXMgJiYgZXJyLnN0YXR1cyA+PSBIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCAmJiBlcnIuc3RhdHVzIDwgNjAwKSB7XG4gICAgICAgIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgICAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzKTtcbiAgICAgICAgICBuZXh0KHsgZXJyb3I6IGVyci5tZXNzYWdlIHx8IEFQSV9FUlJPUi5VTktOT1dOX0VSUk9SIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZXJyb3IoeyBlcnI6IGVyciB9LCAndW5leHBlY3RlZCBlcnJvcjogQHshZXJyLm1lc3NhZ2V9XFxuQHtlcnIuc3RhY2t9Jyk7XG4gICAgICAgIGlmICghcmVzLnN0YXR1cyB8fCAhcmVzLnNlbmQpIHtcbiAgICAgICAgICBsb2dnZXIuZXJyb3IoJ3RoaXMgaXMgYW4gZXJyb3IgaW4gZXhwcmVzcy5qcywgcGxlYXNlIHJlcG9ydCB0aGlzJyk7XG4gICAgICAgICAgcmVzLmRlc3Ryb3koKTtcbiAgICAgICAgfSBlbHNlIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5JTlRFUk5BTF9FUlJPUik7XG4gICAgICAgICAgbmV4dCh7IGVycm9yOiBBUElfRVJST1IuSU5URVJOQUxfU0VSVkVSX0VSUk9SIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHNvY2tldCBzaG91bGQgYmUgYWxyZWFkeSBjbG9zZWRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgbmV4dCgpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQU1BOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLG9CQUFXLFdBQVgsQ0FBZDs7QUFFTyxTQUFTQyxLQUFULENBQWVDLE1BQWYsRUFBb0M7RUFDekMsT0FBTyxVQUFVQyxHQUFWLEVBQStCQyxHQUEvQixFQUFxREMsSUFBckQsRUFBNkVDLEtBQTdFLEVBQWtHO0lBQ3ZHLElBQUlKLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZRCxLQUFaLENBQUosRUFBd0I7TUFDdEJELElBQUk7SUFDTCxDQUZELE1BRU87TUFDTEEsSUFBSSxDQUFDLE9BQUQsQ0FBSjtJQUNEO0VBQ0YsQ0FORDtBQU9EOztBQUVNLFNBQVNHLFlBQVQsQ0FBc0JDLE1BQXRCLEVBQXNDO0VBQzNDLE9BQU8sVUFBVU4sR0FBVixFQUErQkMsR0FBL0IsRUFBcURDLElBQXJELEVBQTZFO0lBQ2xGLElBQUk7TUFBQTs7TUFDRjtNQUNBLE1BQU1LLFFBQWdCLEdBQUdELE1BQUgsYUFBR0EsTUFBSCxzQ0FBR0EsTUFBTSxDQUFFRSxHQUFYLGdEQUFHLFlBQWFDLE9BQXRDOztNQUNBLElBQUlGLFFBQVEsS0FBSyxFQUFqQixFQUFxQjtRQUNuQlYsS0FBSyxDQUFDLGtCQUFELENBQUw7UUFDQUksR0FBRyxDQUFDUyxNQUFKLENBQVcsR0FBWDtNQUNELENBSEQsTUFHTyxJQUFJLENBQUNDLGdCQUFFQyxPQUFGLENBQVVMLFFBQVYsQ0FBTCxFQUEwQjtRQUMvQlYsS0FBSyxDQUFDLGdCQUFELENBQUw7O1FBQ0EsSUFD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