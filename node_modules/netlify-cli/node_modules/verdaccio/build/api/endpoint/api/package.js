"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _lodash = _interopRequireDefault(require("lodash"));

var _constants = require("../../../lib/constants");

var _utils = require("../../../lib/utils");

var _middleware = require("../../middleware");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const downloadStream = (packageName, filename, storage, req, res) => {
  const stream = storage.getTarball(packageName, filename);
  stream.on('content-length', function (content) {
    res.header('Content-Length', content);
  });
  stream.on('error', function (err) {
    return res.locals.report_error(err);
  });
  res.header(_constants.HEADERS.CONTENT_TYPE, _constants.HEADERS.OCTET_STREAM);
  stream.pipe(res);
};

const redirectOrDownloadStream = (packageName, filename, storage, req, res, config) => {
  const tarballUrlRedirect = _lodash.default.get(config, 'experiments.tarball_url_redirect');

  storage.hasLocalTarball(packageName, filename).then(hasLocalTarball => {
    if (hasLocalTarball) {
      const context = {
        packageName,
        filename
      };
      const tarballUrl = typeof tarballUrlRedirect === 'function' ? tarballUrlRedirect(context) : _lodash.default.template(tarballUrlRedirect)(context);
      res.redirect(tarballUrl);
    } else {
      downloadStream(packageName, filename, storage, req, res);
    }
  }).catch(err => {
    res.locals.report_error(err);
  });
};

function _default(route, auth, storage, config) {
  const can = (0, _middleware.allow)(auth); // TODO: anonymous user?

  route.get('/:package/:version?', can('access'), function (req, res, next) {
    const getPackageMetaCallback = function (err, metadata) {
      if (err) {
        return next(err);
      }

      metadata = (0, _utils.convertDistRemoteToLocalTarballUrls)(metadata, req, config.url_prefix);
      let queryVersion = req.params.version;

      if (_lodash.default.isNil(queryVersion)) {
        return next(metadata);
      }

      let version = (0, _utils.getVersion)(metadata, queryVersion);

      if (_lodash.default.isNil(version) === false) {
        return next(version);
      }

      if (_lodash.default.isNil(metadata[_constants.DIST_TAGS]) === false) {
        if (_lodash.default.isNil(metadata[_constants.DIST_TAGS][queryVersion]) === false) {
          queryVersion = metadata[_constants.DIST_TAGS][queryVersion];
          version = (0, _utils.getVersion)(metadata, queryVersion);

          if (_lodash.default.isNil(version) === false) {
            return next(version);
          }
        }
      }

      return next(_utils.ErrorCode.getNotFound(`${_constants.API_ERROR.VERSION_NOT_EXIST}: ${req.params.version}`));
    };

    storage.getPackage({
      name: req.params.package,
      uplinksLook: true,
      req,
      callback: getPackageMetaCallback
    });
  });
  route.get('/:scopedPackage/-/:scope/:filename', can('access'), function (req, res) {
    const {
      scopedPackage,
      filename
    } = req.params;

    if (_lodash.default.get(config, 'experiments.tarball_url_redirect') === undefined) {
      downloadStream(scopedPackage, filename, storage, req, res);
    } else {
      redirectOrDownloadStream(scopedPackage, filename, storage, req, res, config);
    }
  });
  route.get('/:package/-/:filename', can('access'), function (req, res) {
    if (_lodash.default.get(config, 'experiments.tarball_url_redirect') === undefined) {
      downloadStream(req.params.package, req.params.filename, storage, req, res);
    } else {
      redirectOrDownloadStream(req.params.package, req.params.filename, storage, req, res, config);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3dubG9hZFN0cmVhbSIsInBhY2thZ2VOYW1lIiwiZmlsZW5hbWUiLCJzdG9yYWdlIiwicmVxIiwicmVzIiwic3RyZWFtIiwiZ2V0VGFyYmFsbCIsIm9uIiwiY29udGVudCIsImhlYWRlciIsImVyciIsImxvY2FscyIsInJlcG9ydF9lcnJvciIsIkhFQURFUlMiLCJDT05URU5UX1RZUEUiLCJPQ1RFVF9TVFJFQU0iLCJwaXBlIiwicmVkaXJlY3RPckRvd25sb2FkU3RyZWFtIiwiY29uZmlnIiwidGFyYmFsbFVybFJlZGlyZWN0IiwiXyIsImdldCIsImhhc0xvY2FsVGFyYmFsbCIsInRoZW4iLCJjb250ZXh0IiwidGFyYmFsbFVybCIsInRlbXBsYXRlIiwicmVkaXJlY3QiLCJjYXRjaCIsInJvdXRlIiwiYXV0aCIsImNhbiIsIm5leHQiLCJnZXRQYWNrYWdlTWV0YUNhbGxiYWNrIiwibWV0YWRhdGEiLCJ1cmxfcHJlZml4IiwicXVlcnlWZXJzaW9uIiwicGFyYW1zIiwidmVyc2lvbiIsImlzTmlsIiwiRElTVF9UQUdTIiwiRXJyb3JDb2RlIiwiZ2V0Tm90Rm91bmQiLCJBUElfRVJST1IiLCJWRVJTSU9OX05PVF9FWElTVCIsImdldFBhY2thZ2UiLCJuYW1lIiwicGFja2FnZSIsInVwbGlua3NMb29rIiwiY2FsbGJhY2siLCJzY29wZWRQYWNrYWdlIiwidW5kZWZpbmVkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2FwaS9lbmRwb2ludC9hcGkvcGFja2FnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IENvbmZpZywgUGFja2FnZSB9IGZyb20gJ0B2ZXJkYWNjaW8vdHlwZXMnO1xuXG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCBJQXV0aCwgSVN0b3JhZ2VIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vdHlwZXMnO1xuaW1wb3J0IHsgQVBJX0VSUk9SLCBESVNUX1RBR1MsIEhFQURFUlMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29uc3RhbnRzJztcbmltcG9ydCB7IEVycm9yQ29kZSwgY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMsIGdldFZlcnNpb24gfSBmcm9tICcuLi8uLi8uLi9saWIvdXRpbHMnO1xuaW1wb3J0IHsgYWxsb3cgfSBmcm9tICcuLi8uLi9taWRkbGV3YXJlJztcblxuY29uc3QgZG93bmxvYWRTdHJlYW0gPSAocGFja2FnZU5hbWU6IHN0cmluZywgZmlsZW5hbWU6IHN0cmluZywgc3RvcmFnZTogYW55LCByZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCk6IHZvaWQgPT4ge1xuICBjb25zdCBzdHJlYW0gPSBzdG9yYWdlLmdldFRhcmJhbGwocGFja2FnZU5hbWUsIGZpbGVuYW1lKTtcblxuICBzdHJlYW0ub24oJ2NvbnRlbnQtbGVuZ3RoJywgZnVuY3Rpb24gKGNvbnRlbnQpOiB2b2lkIHtcbiAgICByZXMuaGVhZGVyKCdDb250ZW50LUxlbmd0aCcsIGNvbnRlbnQpO1xuICB9KTtcblxuICBzdHJlYW0ub24oJ2Vycm9yJywgZnVuY3Rpb24gKGVycik6IHZvaWQge1xuICAgIHJldHVybiByZXMubG9jYWxzLnJlcG9ydF9lcnJvcihlcnIpO1xuICB9KTtcblxuICByZXMuaGVhZGVyKEhFQURFUlMuQ09OVEVOVF9UWVBFLCBIRUFERVJTLk9DVEVUX1NUUkVBTSk7XG4gIHN0cmVhbS5waXBlKHJlcyk7XG59O1xuXG5jb25zdCByZWRpcmVjdE9yRG93bmxvYWRTdHJlYW0gPSAocGFja2FnZU5hbWU6IHN0cmluZywgZmlsZW5hbWU6IHN0cmluZywgc3RvcmFnZTogYW55LCByZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgY29uZmlnOiBDb25maWcpOiB2b2lkID0+IHtcbiAgY29uc3QgdGFyYmFsbFVybFJlZGlyZWN0ID0gXy5nZXQoY29uZmlnLCAnZXhwZXJpbWVudHMudGFyYmFsbF91cmxfcmVkaXJlY3QnKTtcbiAgc3RvcmFnZVxuICAgIC5oYXNMb2NhbFRhcmJhbGwocGFja2FnZU5hbWUsIGZpbGVuYW1lKVxuICAgIC50aGVuKChoYXNMb2NhbFRhcmJhbGwpID0+IHtcbiAgICAgIGlmIChoYXNMb2NhbFRhcmJhbGwpIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHsgcGFja2FnZU5hbWUsIGZpbGVuYW1lIH07XG4gICAgICAgIGNvbnN0IHRhcmJhbGxVcmwgPSB0eXBlb2YgdGFyYmFsbFVybFJlZGlyZWN0ID09PSAnZnVuY3Rpb24nID8gdGFyYmFsbFVybFJlZGlyZWN0KGNvbnRleHQpIDogXy50ZW1wbGF0ZSh0YXJiYWxsVXJsUmVkaXJlY3QpKGNvbnRleHQpO1xuICAgICAgICByZXMucmVkaXJlY3QodGFyYmFsbFVybCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb3dubG9hZFN0cmVhbShwYWNrYWdlTmFtZSwgZmlsZW5hbWUsIHN0b3JhZ2UsIHJlcSwgcmVzKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICByZXMubG9jYWxzLnJlcG9ydF9lcnJvcihlcnIpO1xuICAgIH0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKHJvdXRlOiBSb3V0ZXIsIGF1dGg6IElBdXRoLCBzdG9yYWdlOiBJU3RvcmFnZUhhbmRsZXIsIGNvbmZpZzogQ29uZmlnKTogdm9pZCB7XG4gIGNvbnN0IGNhbiA9IGFsbG93KGF1dGgpO1xuICAvLyBUT0RPOiBhbm9ueW1vdXMgdXNlcj9cbiAgcm91dGUuZ2V0KCcvOnBhY2thZ2UvOnZlcnNpb24/JywgY2FuKCdhY2Nlc3MnKSwgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgY29uc3QgZ2V0UGFja2FnZU1ldGFDYWxsYmFjayA9IGZ1bmN0aW9uIChlcnIsIG1ldGFkYXRhOiBQYWNrYWdlKTogdm9pZCB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBuZXh0KGVycik7XG4gICAgICB9XG4gICAgICBtZXRhZGF0YSA9IGNvbnZlcnREaXN0UmVtb3RlVG9Mb2NhbFRhcmJhbGxVcmxzKG1ldGFkYXRhLCByZXEsIGNvbmZpZy51cmxfcHJlZml4KTtcblxuICAgICAgbGV0IHF1ZXJ5VmVyc2lvbiA9IHJlcS5wYXJhbXMudmVyc2lvbjtcbiAgICAgIGlmIChfLmlzTmlsKHF1ZXJ5VmVyc2lvbikpIHtcbiAgICAgICAgcmV0dXJuIG5leHQobWV0YWRhdGEpO1xuICAgICAgfVxuXG4gICAgICBsZXQgdmVyc2lvbiA9IGdldFZlcnNpb24obWV0YWRhdGEsIHF1ZXJ5VmVyc2lvbik7XG4gICAgICBpZiAoXy5pc05pbCh2ZXJzaW9uKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIG5leHQodmVyc2lvbik7XG4gICAgICB9XG5cbiAgICAgIGlmIChfLmlzTmlsKG1ldGFkYXRhW0RJU1RfVEFHU10pID09PSBmYWxzZSkge1xuICAgICAgICBpZiAoXy5pc05pbChtZXRhZGF0YVtESVNUX1RBR1NdW3F1ZXJ5VmVyc2lvbl0pID09PSBmYWxzZSkge1xuICAgICAgICAgIHF1ZXJ5VmVyc2lvbiA9IG1ldGFkYXRhW0RJU1RfVEFHU11bcXVlcnlWZXJzaW9uXTtcbiAgICAgICAgICB2ZXJzaW9uID0gZ2V0VmVyc2lvbihtZXRhZGF0YSwgcXVlcnlWZXJzaW9uKTtcbiAgICAgICAgICBpZiAoXy5pc05pbCh2ZXJzaW9uKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXh0KHZlcnNpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG5leHQoRXJyb3JDb2RlLmdldE5vdEZvdW5kKGAke0FQSV9FUlJPUi5WRVJTSU9OX05PVF9FWElTVH06ICR7cmVxLnBhcmFtcy52ZXJzaW9ufWApKTtcbiAgICB9O1xuXG4gICAgc3RvcmFnZS5nZXRQYWNrYWdlKHtcbiAgICAgIG5hbWU6IHJlcS5wYXJhbXMucGFja2FnZSxcbiAgICAgIHVwbGlua3NMb29rOiB0cnVlLFxuICAgICAgcmVxLFxuICAgICAgY2FsbGJhY2s6IGdldFBhY2thZ2VNZXRhQ2FsbGJhY2ssXG4gICAgfSk7XG4gIH0pO1xuXG4gIHJvdXRlLmdldCgnLzpzY29wZWRQYWNrYWdlLy0vOnNjb3BlLzpmaWxlbmFtZScsIGNhbignYWNjZXNzJyksIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCk6IHZvaWQge1xuICAgIGNvbnN0IHsgc2NvcGVkUGFja2FnZSwgZmlsZW5hbWUgfSA9IHJlcS5wYXJhbXM7XG4gICAgaWYgKF8uZ2V0KGNvbmZpZywgJ2V4cGVyaW1lbnRzLnRhcmJhbGxfdXJsX3JlZGlyZWN0JykgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZG93bmxvYWRTdHJlYW0oc2NvcGVkUGFja2FnZSwgZmlsZW5hbWUsIHN0b3JhZ2UsIHJlcSwgcmVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVkaXJlY3RPckRvd25sb2FkU3RyZWFtKHNjb3BlZFBhY2thZ2UsIGZpbGVuYW1lLCBzdG9yYWdlLCByZXEsIHJlcywgY29uZmlnKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJvdXRlLmdldCgnLzpwYWNrYWdlLy0vOmZpbGVuYW1lJywgY2FuKCdhY2Nlc3MnKSwgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kKTogdm9pZCB7XG4gICAgaWYgKF8uZ2V0KGNvbmZpZywgJ2V4cGVyaW1lbnRzLnRhcmJhbGxfdXJsX3JlZGlyZWN0JykgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZG93bmxvYWRTdHJlYW0ocmVxLnBhcmFtcy5wYWNrYWdlLCByZXEucGFyYW1zLmZpbGVuYW1lLCBzdG9yYWdlLCByZXEsIHJlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZGlyZWN0T3JEb3dubG9hZFN0cmVhbShyZXEucGFyYW1zLnBhY2thZ2UsIHJlcS5wYXJhbXMuZmlsZW5hbWUsIHN0b3JhZ2UsIHJlcSwgcmVzLCBjb25maWcpO1xuICAgIH1cbiAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7QUFLQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLGNBQWMsR0FBRyxDQUFDQyxXQUFELEVBQXNCQyxRQUF0QixFQUF3Q0MsT0FBeEMsRUFBc0RDLEdBQXRELEVBQTJFQyxHQUEzRSxLQUEwRztFQUMvSCxNQUFNQyxNQUFNLEdBQUdILE9BQU8sQ0FBQ0ksVUFBUixDQUFtQk4sV0FBbkIsRUFBZ0NDLFFBQWhDLENBQWY7RUFFQUksTUFBTSxDQUFDRSxFQUFQLENBQVUsZ0JBQVYsRUFBNEIsVUFBVUMsT0FBVixFQUF5QjtJQUNuREosR0FBRyxDQUFDSyxNQUFKLENBQVcsZ0JBQVgsRUFBNkJELE9BQTdCO0VBQ0QsQ0FGRDtFQUlBSCxNQUFNLENBQUNFLEVBQVAsQ0FBVSxPQUFWLEVBQW1CLFVBQVVHLEdBQVYsRUFBcUI7SUFDdEMsT0FBT04sR0FBRyxDQUFDTyxNQUFKLENBQVdDLFlBQVgsQ0FBd0JGLEdBQXhCLENBQVA7RUFDRCxDQUZEO0VBSUFOLEdBQUcsQ0FBQ0ssTUFBSixDQUFXSSxtQkFBUUMsWUFBbkIsRUFBaUNELG1CQUFRRSxZQUF6QztFQUNBVixNQUFNLENBQUNXLElBQVAsQ0FBWVosR0FBWjtBQUNELENBYkQ7O0FBZUEsTUFBTWEsd0JBQXdCLEdBQUcsQ0FBQ2pCLFdBQUQsRUFBc0JDLFFBQXRCLEVBQXdDQyxPQUF4QyxFQUFzREMsR0FBdEQsRUFBMkVDLEdBQTNFLEVBQWlHYyxNQUFqRyxLQUEwSDtFQUN6SixNQUFNQyxrQkFBa0IsR0FBR0MsZ0JBQUVDLEdBQUYsQ0FBTUgsTUFBTixFQUFjLGtDQUFkLENBQTNCOztFQUNBaEIsT0FBTyxDQUNKb0IsZUFESCxDQUNtQnRCLFdB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