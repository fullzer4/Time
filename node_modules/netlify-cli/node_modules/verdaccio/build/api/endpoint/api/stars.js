"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _lodash = _interopRequireDefault(require("lodash"));

var _constants = require("../../../lib/constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @prettier

 */
function _default(route, storage) {
  route.get('/-/_view/starredByUser', (req, res, next) => {
    const remoteUsername = req.remote_user.name;
    storage.getLocalDatabase((err, localPackages) => {
      if (err) {
        return next(err);
      }

      const filteredPackages = localPackages.filter(localPackage => _lodash.default.keys(localPackage[_constants.USERS]).includes(remoteUsername));
      res.status(_constants.HTTP_STATUS.OK);
      next({
        rows: filteredPackages.map(filteredPackage => ({
          value: filteredPackage.name
        }))
      });
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyb3V0ZSIsInN0b3JhZ2UiLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwicmVtb3RlVXNlcm5hbWUiLCJyZW1vdGVfdXNlciIsIm5hbWUiLCJnZXRMb2NhbERhdGFiYXNlIiwiZXJyIiwibG9jYWxQYWNrYWdlcyIsImZpbHRlcmVkUGFja2FnZXMiLCJmaWx0ZXIiLCJsb2NhbFBhY2thZ2UiLCJfIiwia2V5cyIsIlVTRVJTIiwiaW5jbHVkZXMiLCJzdGF0dXMiLCJIVFRQX1NUQVRVUyIsIk9LIiwicm93cyIsIm1hcCIsImZpbHRlcmVkUGFja2FnZSIsInZhbHVlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2FwaS9lbmRwb2ludC9hcGkvc3RhcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAcHJldHRpZXJcblxuICovXG5pbXBvcnQgeyBSZXNwb25zZSwgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBQYWNrYWdlIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5cbmltcG9ydCB7ICROZXh0RnVuY3Rpb25WZXIsICRSZXF1ZXN0RXh0ZW5kLCBJU3RvcmFnZUhhbmRsZXIgfSBmcm9tICcuLi8uLi8uLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBIVFRQX1NUQVRVUywgVVNFUlMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29uc3RhbnRzJztcblxudHlwZSBQYWNrYWdlcyA9IFBhY2thZ2VbXTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKHJvdXRlOiBSb3V0ZXIsIHN0b3JhZ2U6IElTdG9yYWdlSGFuZGxlcik6IHZvaWQge1xuICByb3V0ZS5nZXQoJy8tL192aWV3L3N0YXJyZWRCeVVzZXInLCAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiBSZXNwb25zZSwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHJlbW90ZVVzZXJuYW1lID0gcmVxLnJlbW90ZV91c2VyLm5hbWU7XG5cbiAgICBzdG9yYWdlLmdldExvY2FsRGF0YWJhc2UoKGVyciwgbG9jYWxQYWNrYWdlczogUGFja2FnZXMpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlsdGVyZWRQYWNrYWdlczogUGFja2FnZXMgPSBsb2NhbFBhY2thZ2VzLmZpbHRlcigobG9jYWxQYWNrYWdlOiBQYWNrYWdlKSA9PiBfLmtleXMobG9jYWxQYWNrYWdlW1VTRVJTXSkuaW5jbHVkZXMocmVtb3RlVXNlcm5hbWUpKTtcblxuICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5PSyk7XG4gICAgICBuZXh0KHtcbiAgICAgICAgcm93czogZmlsdGVyZWRQYWNrYWdlcy5tYXAoKGZpbHRlcmVkUGFja2FnZTogUGFja2FnZSkgPT4gKHtcbiAgICAgICAgICB2YWx1ZTogZmlsdGVyZWRQYWNrYWdlLm5hbWUsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUtBOztBQUtBOzs7O0FBVkE7QUFDQTtBQUNBO0FBQ0E7QUFXZSxrQkFBVUEsS0FBVixFQUF5QkMsT0FBekIsRUFBeUQ7RUFDdEVELEtBQUssQ0FBQ0UsR0FBTixDQUFVLHdCQUFWLEVBQW9DLENBQUNDLEdBQUQsRUFBc0JDLEdBQXRCLEVBQXFDQyxJQUFyQyxLQUFzRTtJQUN4RyxNQUFNQyxjQUFjLEdBQUdILEdBQUcsQ0FBQ0ksV0FBSixDQUFnQkMsSUFBdkM7SUFFQVAsT0FBTyxDQUFDUSxnQkFBUixDQUF5QixDQUFDQyxHQUFELEVBQU1DLGFBQU4sS0FBa0M7TUFDekQsSUFBSUQsR0FBSixFQUFTO1FBQ1AsT0FBT0wsSUFBSSxDQUFDSyxHQUFELENBQVg7TUFDRDs7TUFFRCxNQUFNRSxnQkFBMEIsR0FBR0QsYUFBYSxDQUFDRSxNQUFkLENBQXNCQyxZQUFELElBQTJCQyxnQkFBRUMsSUFBRixDQUFPRixZQUFZLENBQUNHLGdCQUFELENBQW5CLEVBQTRCQyxRQUE1QixDQUFxQ1osY0FBckMsQ0FBaEQsQ0FBbkM7TUFFQUYsR0FBRyxDQUFDZSxNQUFKLENBQVdDLHVCQUFZQyxFQUF2QjtNQUNBaEIsSUFBSSxDQUFDO1FBQ0hpQixJQUFJLEVBQUVWLGdCQUFnQixDQUFDVyxHQUFqQixDQUFzQkMsZUFBRCxLQUErQjtVQUN4REMsS0FBSyxFQUFFRCxlQUFlLENBQUNoQjtRQURpQyxDQUEvQixDQUFyQjtNQURILENBQUQsQ0FBSjtJQUtELENBYkQ7RUFjRCxDQWpCRDtBQWtCRCJ9